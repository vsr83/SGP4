!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.sgp4=e():t.sgp4=e()}(self,(()=>(()=>{"use strict";var t={d:(e,a)=>{for(var o in a)t.o(a,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{createTarget:()=>p,propagateTarget:()=>D,tleFromLines:()=>n});const a={FIELD_NUMBER:1,FIELD_NUMBER_IMPLIED:2,FIELD_NUMBER_MAPPED:3,FIELD_STRING:4},o=[{name:"title",fieldType:a.FIELD_STRING,row:0,startCol:0,endCol:23},{name:"catalogNumber",fieldType:a.FIELD_NUMBER,row:1,startCol:2,endCol:6},{name:"classification",fieldType:a.FIELD_STRING,row:1,startCol:7,endCol:7},{name:"intLaunchYear",fieldType:a.FIELD_STRING,row:1,startCol:9,endCol:10},{name:"intLaunchNum",fieldType:a.FIELD_STRING,row:1,startCol:11,endCol:13},{name:"intLaunchPiece",fieldType:a.FIELD_STRING,row:1,startCol:14,endCol:16},{name:"epochYear",fieldType:a.FIELD_NUMBER_MAPPED,row:1,startCol:18,endCol:19,callback:function(t){return t>56?1900+t:2e3+t}},{name:"epochFracDay",fieldType:a.FIELD_NUMBER,row:1,startCol:20,endCol:31},{name:"meanMotionDer",fieldType:a.FIELD_NUMBER,row:1,startCol:33,endCol:42},{name:"meanMotionDer2",fieldType:a.FIELD_NUMBER_IMPLIED,row:1,startCol:44,endCol:51},{name:"dragTerm",fieldType:a.FIELD_NUMBER_IMPLIED,row:1,startCol:53,endCol:60},{name:"ephemerisType",fieldType:a.FIELD_NUMBER,row:1,startCol:62,endCol:62},{name:"elementSetNo",fieldType:a.FIELD_NUMBER,row:1,startCol:64,endCol:67},{name:"checkSum1",fieldType:a.FIELD_NUMBER,row:1,startCol:68,endCol:68},{name:"catalogNumber2",fieldType:a.FIELD_NUMBER,row:2,startCol:2,endCol:6},{name:"inclination",fieldType:a.FIELD_NUMBER,row:2,startCol:8,endCol:15},{name:"raAscNode",fieldType:a.FIELD_NUMBER,row:2,startCol:17,endCol:24},{name:"eccentricity",fieldType:a.FIELD_NUMBER_IMPLIED,row:2,startCol:26,endCol:32},{name:"argPerigee",fieldType:a.FIELD_NUMBER,row:2,startCol:34,endCol:41},{name:"meanAnomaly",fieldType:a.FIELD_NUMBER,row:2,startCol:43,endCol:50},{name:"meanMotion",fieldType:a.FIELD_NUMBER,row:2,startCol:52,endCol:62},{name:"revNoAtEpoch",fieldType:a.FIELD_NUMBER,row:2,startCol:63,endCol:67},{name:"checkSum2",fieldType:a.FIELD_NUMBER,row:2,startCol:68,endCol:68}];function n(t){const e={},n={};for(let e=0;e<o.length;e++){const r=o[e],c=t[r.row].substring(r.startCol,r.endCol+1);switch(r.fieldType){case a.FIELD_STRING:n[r.name]=c;break;case a.FIELD_NUMBER:n[r.name]=Number(c);break;case a.FIELD_NUMBER_IMPLIED:"-"==c[0]?n[r.name]=-Number("0."+c.substring(1).replace("-","e-").replace("+","e").replace(" ","")):n[r.name]=Number("0."+c.replace("-","e-").replace("+","e").replace(" ",""));break;case a.FIELD_NUMBER_MAPPED:r.callback&&(n[r.name]=r.callback(Number(c)))}}return function(t){e.title=t.title,e.catalogNumber=t.catalogNumber,e.classification=t.classification,e.intLaunchYear=t.intLaunchYear,e.intLaunchNum=t.intLaunchNum,e.intLaunchPiece=t.intLaunchPiece,e.epochYear=t.epochYear,e.epochFracDay=t.epochFracDay,e.meanMotionDer=t.meanMotionDer,e.meanMotionDer2=t.meanMotionDer2,e.dragTerm=t.dragTerm,e.ephemerisType=t.ephemerisType,e.elementSetNo=t.elementSetNo,e.checkSum1=t.checkSum1,e.catalogNumber2=t.catalogNumber2,e.inclination=t.inclination,e.raAscNode=t.raAscNode,e.eccentricity=t.eccentricity,e.argPerigee=t.argPerigee,e.meanAnomaly=t.meanAnomaly,e.meanMotion=t.meanMotion,e.revNoAtEpoch=t.revNoAtEpoch,e.checkSum2=t.checkSum2}(n),e.checkSumValid=r(t[1])==e.checkSum1&&r(t[2])==e.checkSum2,e.jtUt1Epoch=function(t,e){const a=[31,t%4==0?29:28,31,30,31,30,31,31,30,31,30,31],o=Math.floor(e);let n=0,r=0;for(n=0;n<12;n++){const t=a[n];if(o-r-t<0)break;r+=t}const c=o-r,i=e-o,s=Math.floor(24*i),M=Math.floor(1440*(i-s/24));return function(t,e,a,o,n,r){const c=function(t,e,a){e<3&&(t--,e+=12);const o=Math.floor(t/100),n=Math.floor(o/4);return Math.floor(2-o+n)+a+Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))-1524.5}(t,e,a);return c+o/24+n/1440+r/86400}(t,n+1,c,s,M,86400*(i-s/24-M/1440))}(e.epochYear,e.epochFracDay),e}function r(t){let e=0;const a=t.substring(0,68);for(let t=0;t<a.length;t++){const o=a[t];"0123456789".indexOf(o)>-1?e+=parseInt(o):"-"==o&&e++}return e%10}const c={mu:398600.8,radiusEarthKm:6378.135,xke:.07436691613317342,tumin:13.44683969695931,j2:.001082616,j3:-253881e-11,j4:-165597e-11},i={ERROR_NONE:0,ERROR_MEAN_ECCENTRICITY:1,ERROR_MEAN_MOTION:2,ERROR_PERT_ECCENTRICITY:3,ERROR_SEMI_LATUS_RECTUM:4,ERROR_EPOCH_SUBORBITAL:5,ERROR_SATELLITE_DECAYED:6,ERROR_INVALID_TSINCE:7};function s(t){const e=(t-2451545)/36525,a=2*Math.PI;let o=-62e-7*e*e*e+.093104*e*e+3164400184.812866*e+67310.54841;return o=o*Math.PI/43200%a,o<0&&(o+=a),o}function M(t){return 2*Math.PI*t/360}function m(t,e){const a=[];let o=1;a.push(o);for(let n=1;n<=e;n++)o*=t,a.push(o);return a}function l(t,e,a,o){const n=M(t.meanAnomaly),r=M(t.argPerigee),c=M(t.raAscNode);return{a:e.semiMajorAxisBrouwer,incl:M(t.inclination),ecc:t.eccentricity,M:n+a.MDot*o,omega:r+a.omegaDot*o,Omega:c+a.OmegaDot*o}}function h(t,e,a){const o=-c.j3,n=.5*c.j2,r=Math.sqrt(1-e.ecc**2);let s=M(t.inclination);void 0!==a&&(s=a);const m=Math.cos(s),l=o*Math.sin(e.incl)/(4*n*e.a*r*r),h=e.ecc*Math.cos(e.omega),d=e.M+e.omega+e.Omega+.5*l*h*(3+5*m)/(1+m),u=e.ecc*Math.sin(e.omega)+l,E=function(t){const e=2*Math.PI;return t-e*Math.floor(t/e)}(d-e.Omega);let f=E,g=1e-12+1,p=0;for(;p<=10&&Math.abs(g)>1e-12;)g=-(E-u*Math.cos(f)+h*Math.sin(f)-f)/(u*Math.sin(f)+h*Math.cos(f)-1),Math.abs(g)>=.95&&(g=.95*Math.sign(g)),f+=g,p++;const D=h*Math.cos(f)+u*Math.sin(f),I=h*Math.sin(f)-u*Math.cos(f),N=Math.atan2(I,D),R=Math.sqrt(h*h+u*u),C=e.a*(1-R*R);if(C<0)throw{type:i.ERROR_SEMI_LATUS_RECTUM,message:"Semi-latus rectum "+C+" negative!"};const y=e.a*(1-R*Math.cos(N)),_=e.a/y*(Math.cos(f)-h+u*I/(1+Math.sqrt(1-R**2))),b=e.a/y*(Math.sin(f)-u-h*I/(1+Math.sqrt(1-R**2))),w=Math.atan2(b,_),O=Math.sqrt(e.a)*I/y,T=Math.sqrt(C)/y,A=Math.pow(e.a,-1.5),P=Math.sin(2*w),B=Math.cos(2*w),L=m**2,S=.5*n*(1-L)*B/C,Z=-.25*n*(7*L-1)*P/(C*C),F=1.5*n*m*P/(C*C),U=1.5*n*m*Math.sin(e.incl)*B/(C*C),j=-n*A*(1-L)*P/C,k=n*A*((1-L)*B-1.5*(1-3*L))/C,x=y*(1-1.5*n*Math.sqrt(1-R**2)*(3*L-1)/C**2)+S,X=w+Z,Y=e.Omega+F,v=e.incl+U,q=O+j,G=T+k;if(x<1)throw{type:i.ERROR_SATELLITE_DECAYED,message:"Satellite orbit decayed!"};return{r:x,u:X,Omega:Y,incl:v,rdot:q,rfdot:G}}function d(t){const e=-Math.sin(t.Omega)*Math.cos(t.incl),a=Math.cos(t.Omega)*Math.cos(t.incl),o=Math.sin(t.incl),n=Math.cos(t.Omega),r=Math.sin(t.Omega),i=e*Math.sin(t.u)+n*Math.cos(t.u),s=a*Math.sin(t.u)+r*Math.cos(t.u),M=o*Math.sin(t.u)+0*Math.cos(t.u),m=e*Math.cos(t.u)-n*Math.sin(t.u),l=a*Math.cos(t.u)-r*Math.sin(t.u),h=o*Math.cos(t.u)-0*Math.sin(t.u),d=c.radiusEarthKm*c.xke/60;return{r:[t.r*i*c.radiusEarthKm,t.r*s*c.radiusEarthKm,t.r*M*c.radiusEarthKm],v:[(t.rdot*i+t.rfdot*m)*d,(t.rdot*s+t.rfdot*l)*d,(t.rdot*M+t.rfdot*h)*d]}}function u(t,e,a,o,n,r,c){const i=Math.cos(n),s=Math.sin(n),M=Math.cos(r),m=Math.sin(r),l=Math.cos(e),h=Math.sin(e),d=Math.cos(a),u=Math.sin(a),E=Math.cos(o-c),f=Math.sin(o-c),g=M*E+m*i*f,p=-m*E+M*i*f,D=-M*f+m*i*E,I=m*s,N=m*f+M*i*E,R=M*s,C=D*l+I*h,y=N*l+R*h,_=-D*h+I*l,b=-N*h+R*l,w=g*d+C*u,O=p*d+y*u,T=-g*u+C*d,A=-p*u+y*d,P=_*u,B=b*u,L=_*d,S=b*d,Z=t*t,F=12*w*w-3*T*T,U=24*w*O-6*T*A,j=12*O*O-3*A*A;return{a1:g,a2:C,a3:p,a4:y,a5:_,a6:b,a7:D,a8:I,a9:N,a10:R,X1:w,X2:O,X3:T,X4:A,X5:P,X6:B,X7:L,X8:S,Z1:6*(g*g+C*C)+(1+Z)*F,Z2:12*(g*p+C*y)+(1+Z)*U,Z3:6*(p*p+y*y)+(1+Z)*j,Z11:-6*g*_+Z*(-24*w*L-6*T*P),Z12:-6*g*b-6*p*_-Z*(24*O*L+24*w*S+6*T*B+6*A*P),Z13:-6*p*b+Z*(-24*O*S-6*A*B),Z21:6*C*_+Z*(24*w*P-6*T*L),Z22:6*y*_+6*C*b+Z*(24*O*P+24*w*B-6*A*L-6*T*S),Z23:6*y*b+Z*(24*O*B-6*A*S),Z31:F,Z32:U,Z33:j}}function E(t,e,a,o,n,r){const c=o+2*n*Math.sin(o),i=.5*Math.sin(c)*Math.sin(c)-.25,s=-.5*Math.sin(c)*Math.cos(c),M=Math.sqrt(1-t*t);return{deltaecc:-30*M*r*t/e*(i*(a.X2*a.X3+a.X1*a.X4)+s*(a.X2*a.X4-a.X1*a.X3)),deltaI:-r/(e*M)*(i*a.Z12+s*(a.Z13-a.Z11)),deltaM:-2*r/e*(i*a.Z2+s*(a.Z3-a.Z1)-3*n*Math.sin(c)*(7+3*t*t)),deltaomegaI:2*M*r/e*(i*a.Z32+s*(a.Z33-a.Z31)-9*n*Math.sin(c)),deltaOmegaI:r/(e*M)*(i*a.Z22+s*(a.Z23-a.Z21))}}const f={NO_RESONANCE:1,ONE_DAY_RESONANCE:2,HALF_DAY_RESONANCE:3};const g={SGP4:1,SDP4:2};function p(t){const e={};var a;return e.tle=t,e.brouwer=function(t){const e=M(t.inclination),a=1440/(2*Math.PI),o=1-t.eccentricity*t.eccentricity,n=Math.cos(e),r=t.meanMotion/a,i=Math.pow(c.xke/r,2/3),s=.75*c.j2*(3*n*n-1)/(Math.sqrt(o)*o);let m=s/(i*i);const l=i*(1-m*(1/3+m*(1+134/81*m)));m=s/(l*l);const h=r/(1+m);return{meanMotionBrouwer:h,semiMajorAxisBrouwer:Math.pow(c.xke/h,2/3)}}(t),e.secGrav=function(t,e){const a=M(t.inclination),o=m(Math.cos(a),4),n=m(e.semiMajorAxisBrouwer*c.radiusEarthKm,4),r=m(Math.sqrt(1-t.eccentricity*t.eccentricity),8),i=m(c.radiusEarthKm,4),s=.5*i[2]*c.j2,l=-.375*i[4]*c.j4;let h=1+1.5*s*(3*o[2]-1)/(n[2]*r[3])+.1875*s*s*(13-78*o[2]+137*o[4])/(n[4]*r[7]),d=1.5*s*(5*o[2]-1)/(n[2]*r[4])+.1875*s*s*(7-114*o[2]+395*o[4])/(n[4]*r[8])+1.25*l*(3-36*o[2]+49*o[4])/(n[4]*r[8]),u=-3*s*o[1]/(n[2]*r[4])+1.5*s*s*(4*o[1]-19*o[3])/(n[4]*r[8])+2.5*l*(3*o[1]-7*o[3])/(n[4]*r[8]);return h*=e.meanMotionBrouwer,d*=e.meanMotionBrouwer,u*=e.meanMotionBrouwer,{MDot:h,omegaDot:d,OmegaDot:u}}(t,e.brouwer),e.dragTerms=function(t,e){const a=e.semiMajorAxisBrouwer*(1-t.eccentricity);let o=!1;a<220/c.radiusEarthKm+1&&(o=!0);const n=(a-1)*c.radiusEarthKm;let r;r=n<98?20:n<156?n-78:78;const i=r/c.radiusEarthKm+1,s=Math.pow((120-r)/c.radiusEarthKm,4),l=t.eccentricity,h=e.semiMajorAxisBrouwer,d=e.meanMotionBrouwer,u=M(t.argPerigee),E=M(t.inclination),f=m(1/(h-i),5),g=m(h*l*f[1],8),p=m(Math.sqrt(1-l*l),2),D=m(Math.cos(E),2),I=-c.j3,N=.5*c.j2;let R=s*f[4]*d*Math.pow(1-g[2],-3.5)*(h*(1+1.5*g[2]+l*(4*g[1]+g[3]))+1.5*N*f[1]/(1-g[2])*(1.5*D[2]-.5)*(8+24*g[2]+3*g[4]));const C=m(t.dragTerm*R,4);let y=0;l>1e-4&&(y=s*f[5]*I*d*Math.sin(E)/(N*l));const _=2*d*s*f[4]*h*p[2]*Math.pow(1-g[2],-3.5)*(2*g[1]*(1+l*g[1])+.5*l+.5*g[3]-2*N*f[1]/(h*(1-g[2]))*(3*(1-3*D[2])*(1+1.5*g[2]-2*l*g[1]-.5*l*g[3])+.75*(1-D[2])*(2*g[2]-l*g[1]-l*g[3])*Math.cos(2*u))),b=2*s*f[4]*h*p[2]*Math.pow(1-g[2],-3.5)*(1+2.75*g[1]*(g[1]+l)+l*g[3]),w=4*h*f[1]*C[2],O=4/3*h*f[2]*(17*h+i)*C[3],T=2/3*h*h*f[3]*(221*h+31*i)*C[4];return{C1:C,C2:R,C3:y,C4:_,C5:b,D2:w,D3:O,D4:T,t2cof:1.5*C[1],t3cof:w+2*C[2],t4cof:.25*(3*O+12*C[1]*w+10*C[3]),t5cof:.2*(3*T+12*C[1]*O+6*w**2+30*C[2]*w+15*C[4]),qs4Term:s,s:i,xi:f,eta:g,beta0:p,theta:D,useSimplifiedDrag:o}}(t,e.brouwer),a=e.brouwer,2*Math.PI/a.meanMotionBrouwer<225?e.solverType=g.SGP4:(e.solverType=g.SDP4,e.thirdBodyCommon=function(t,e){const a=M(281.2208026160437),o=298647972e-14,n=4.796806521e-7,r=119459e-10,c=.00015835218,i=M(23.444100086478358),s=M(t.raAscNode),m=M(t.inclination),l=M(t.argPerigee),h=t.eccentricity,d=e.meanMotionBrouwer,E=Math.sqrt(1-h*h),f=t.jtUt1Epoch-2415020,g=(4.523602-.00092422029*f)%(2*Math.PI),p=5.8351514+.001944368*f,D=M(5.145400276825767),I=Math.cos(i)*Math.cos(D)-Math.sin(i)*Math.sin(D)*Math.cos(g),N=Math.sqrt(1-I**2),R=Math.atan2(N,I),C=Math.sin(D)*Math.sin(g)/Math.sin(R),y=Math.sqrt(1-C**2),_=Math.atan2(C,y),b=Math.sin(i)*Math.sin(g)/Math.sin(R),w=Math.cos(_)*Math.cos(g)+Math.sin(_)*Math.sin(g)*Math.cos(i),O=p-g+Math.atan2(b,w),T=u(h,m,l,s,i,a,0),A=u(h,m,l,s,R,O,_),P=-15*o*r*h/d*E*(T.X1*T.X3+T.X2*T.X4),B=-15*n*c*h/d*E*(A.X1*A.X3+A.X2*A.X4),L=-.5*o*r/E/d*(T.Z11+T.Z13),S=-.5*n*c/E/d*(A.Z11+A.Z13),Z=-o*r/d*(T.Z1+T.Z3-14-6*h*h),F=-n*c/d*(A.Z1+A.Z3-14-6*h*h);let U,j,k,x;return t.inclination<3?(U=0,j=0):(U=o*r/(2*d*E*Math.sin(m))*(T.Z21+T.Z23),j=n*c/(2*d*E*Math.sin(m))*(A.Z21+A.Z23)),t.inclination<3?(k=o*r*E/d*(T.Z31+T.Z33-6),x=n*c*E/d*(A.Z31+A.Z33-6)):(k=o*r*E/d*(T.Z31+T.Z33-6)-U*Math.cos(m),x=n*c*E/d*(A.Z31+A.Z33-6)-j*Math.cos(m)),{sun:T,moon:A,secularRates:{dedt:P+B,dIdt:L+S,dMdt:Z+F,dOmegadt:U+j,domegadt:k+x}}}(t,e.brouwer),e.resonance=function(t,e){let a,o=f.NO_RESONANCE;return e.meanMotionBrouwer>.0034906585&&e.meanMotionBrouwer<.0052359877&&(o=f.ONE_DAY_RESONANCE,a=function(t,e){const a=M(t.inclination),o=Math.cos(a),n=Math.sin(a),r=t.eccentricity,c=e.meanMotionBrouwer,i=e.semiMajorAxisBrouwer;return{delta1:3*c**2/i**3*(.9375*n**2*(1+3*o)-.75*(1+o))*(1+2*r**2)*21460748e-13,delta2:6*c**2/i**2*(.75*Math.pow(1+o,2))*(1-2.5*r**2+.8125*r**4)*17891679e-13,delta3:9*c**2/i**3*(1.875*Math.pow(1+o,3))*(1-6*r**2+6.60937*r**4)*2.2123015e-7}}(t,e)),e.meanMotionBrouwer>=.00826&&e.meanMotionBrouwer<=.00924&&t.eccentricity>=.5&&(o=f.HALF_DAY_RESONANCE,a=function(t,e){const a=t.eccentricity,o=a*a,n=o*a,r=M(t.inclination),c=Math.sin(r),i=c*c,s=Math.cos(r),m=s*s,l=-.306-.44*(a-.64);let h,d,u,E,f,g,p,D,I;a<=.65?(h=3.616-13.247*a+16.29*o,d=117.39*a-19.302-228.419*o+156.591*n,u=109.7927*a-18.9068-214.6334*o+146.5816*n,E=242.694*a-41.122-471.094*o+313.953*n,f=841.88*a-146.407-1629.014*o+1083.435*n,g=3017.977*a-532.114-5740.032*o+3708.276*n):(h=331.819*a-72.099-508.738*o+266.724*n,d=1582.851*a-346.844-2415.925*o+1246.113*n,u=1554.908*a-342.585-2366.899*o+1215.972*n,E=4758.686*a-1052.797-7193.992*o+3651.957*n,f=16178.11*a-3581.69-24462.77*o+12422.52*n,g=a>.715?29936.92*a-5149.66-54087.36*o+31324.56*n:1464.74-4664.75*a+3763.64*o),a<.7?(I=4988.61*a-919.2277-9064.77*o+5542.21*n,p=4568.6173*a-822.71072-8491.4146*o+5337.524*n,D=4690.25*a-853.666-8624.77*o+5341.4*n):(I=161616.52*a-37995.78-229838.2*o+109377.94*n,p=218913.95*a-51752.104-309468.16*o+146349.42*n,D=170470.89*a-40023.88-242699.48*o+115605.82*n);const N=.75*(1+2*s+m),R=1.5*i,C=1.875*c*(1-2*s-3*m),y=-1.875*c*(1+2*s-3*m),_=35*i*N,b=39.375*i*i,w=9.84375*c*(i*(1-2*s-5*m)+.33333333*(4*s-2+6*m)),O=c*(4.92187512*i*(-2-4*s+10*m)+6.56250012*(1+2*s-3*m)),T=29.53125*c*(2-8*s+m*(8*s-12+10*m)),A=29.53125*c*(-2-8*s+m*(12+8*s-10*m)),P=17891679e-13,B=3.7393792e-7,L=7.3636953e-9,S=1.1428639e-7,Z=2.1765803e-9,F=e.meanMotionBrouwer,U=e.semiMajorAxisBrouwer,j=F*F*3;return{D2201:j/U**2*P*N*l,D2211:j/U**2*P*R*h,D3210:j/U**3*B*C*d,D3222:j/U**3*B*y*u,D4410:j/U**4*2*L*_*E,D4422:j/U**4*2*L*b*f,D5220:j/U**5*S*w*g,D5232:j/U**5*S*O*D,D5421:j/U**5*2*Z*T*p,D5433:j/U**5*2*Z*A*I}}(t,e)),{type:o,coeffs:a}}(t,e.brouwer),e.integrationState=function(t,e,a,o,n){const r=M(t.meanAnomaly),c=M(t.raAscNode),i=M(t.argPerigee),m=s(t.jtUt1Epoch),l=.0043752690880113;let h,d,u;return n==f.HALF_DAY_RESONANCE?(h=(r+2*c-2*m)%(2*Math.PI),d=o.MDot+a.dMdt+2*(o.OmegaDot+a.dOmegadt-l)-e.meanMotionBrouwer,u=e.meanMotionBrouwer):n==f.ONE_DAY_RESONANCE&&(h=(r+c+i-m)%(2*Math.PI),d=o.MDot+a.dMdt+o.OmegaDot+a.dOmegadt+o.omegaDot+a.domegadt-l-e.meanMotionBrouwer,u=e.meanMotionBrouwer),{minsAfterEpoch:0,lambda:h,lambda0:h,dlambdadt:d,dlambdadt0:d,n:u,n0:u,dndt:0}}(t,e.brouwer,e.thirdBodyCommon.secularRates,e.secGrav,e.resonance.type),e.dragTerms.useSimplifiedDrag=!0),e}function D(t,e){if("number"!=typeof e)throw{type:i.ERROR_INVALID_TSINCE,message:"tSince parameter "+e+" not a number!"};if(t.solverType==g.SGP4){const a=l(t.tle,t.brouwer,t.secGrav,e),o=function(t,e,a,o,n){const{C1:r,C2:i,C3:s,C4:l,C5:h,D2:d,D3:u,D4:E,qs4Term:f,s:g,t2cof:p,t3cof:D,t4cof:I,t5cof:N,xi:R,eta:C,beta0:y,theta:_,useSimplifiedDrag:b}=o,w=(M(t.meanAnomaly),M(t.argPerigee)),O=M(t.meanAnomaly),T=t.eccentricity,A=m(e.semiMajorAxisBrouwer,2),P=e.meanMotionBrouwer,B=m(n,5),L=(M(t.inclination),.5*c.j2),S=t.dragTerm;let Z,F,U,j,k,x;if(b){Z=a.M,F=a.omega,U=a.Omega-P*L*_[1]*10.5/(A[2]*y[2])*r[1]*B[2],j=t.eccentricity-S*l*B[1],j<1e-6&&(j=1e-6);const o=e.meanMotionBrouwer;k=Math.pow(c.xke/o,2/3)*Math.pow(1-r[1]*B[1],2),x=Z+F+U+P*(p*B[2])}else{const o=t.dragTerm*s*Math.cos(w)*n;let i=-2/3*f*t.dragTerm*R[4]/(C[1]*T)*(Math.pow(1+C[1]*Math.cos(a.M),3)-Math.pow(1+C[1]*Math.cos(O),3));t.eccentricity<=1e-4&&(i=0),Z=a.M+o+i,F=a.omega-o-i,U=a.Omega-P*L*_[1]*10.5/(A[2]*y[2])*r[1]*B[2],j=t.eccentricity-S*l*B[1]-S*h*(Math.sin(Z)-Math.sin(O)),j<1e-6&&(j=1e-6);const M=e.meanMotionBrouwer;k=Math.pow(c.xke/M,2/3)*Math.pow(1-r[1]*B[1]-d*B[2]-u*B[3]-E*B[4],2),x=Z+F+U+P*(p*B[2]+D*B[3]+I*B[4]+N*B[5])}return x%=2*Math.PI,Z=(x-F-U)%(2*Math.PI),{a:k,incl:a.incl,ecc:j,M:Z,omega:F,Omega:U,L:x}}(t.tle,t.brouwer,a,t.dragTerms,e);if(o.ecc>=1||o.ecc<-.001)throw{type:i.ERROR_PERT_ECCENTRICITY,message:"Eccentricity "+kepler4.ecc+" invalid!"};return d(h(t.tle,o))}{const a=function(t,e,a){return{a:t.a,incl:t.incl+a*e.dIdt,ecc:t.ecc+a*e.dedt,M:t.M+a*e.dMdt,omega:t.omega+a*e.domegadt,Omega:t.Omega+a*e.dOmegadt}}(l(t.tle,t.brouwer,t.secGrav,e),t.thirdBodyCommon.secularRates,e);let o;if(o=t.resonance.type==f.NO_RESONANCE?{M:a.M,n:c.xke/Math.pow(a.a,1.5)}:function(t,e,a,o,n,r){let c=720,i=c*c;n-r.minsAfterEpoch<0&&(c=-c);const m=5.7686396,l=.95240898,h=1.8014998,d=1.050833,u=4.4108898,E=.13130908,g=2.8843198,p=.37448087,D=(s(t.jtUt1Epoch)+.0043752690880113*n)%(2*Math.PI);for(;;){if(e.type==f.ONE_DAY_RESONANCE){const t=e.coeffs;r.dndt=t.delta1*Math.sin(r.lambda-E)+t.delta2*Math.sin(2*(r.lambda-g))+t.delta3*Math.sin(3*(r.lambda-p)),r.dlambdadt=r.n+r.dlambdadt0,r.dnddt=t.delta1*Math.cos(r.lambda-E)+2*t.delta2*Math.cos(2*(r.lambda-g))+3*t.delta3*Math.cos(3*(r.lambda-p)),r.dnddt*=r.dlambdadt}else if(e.type==f.HALF_DAY_RESONANCE){const o=M(t.argPerigee)+a.omegaDot*r.minsAfterEpoch,n=e.coeffs;r.dndt=n.D2201*Math.sin(2*o+r.lambda-m)+n.D2211*Math.sin(r.lambda-m)+n.D3210*Math.sin(o+r.lambda-l)+n.D3222*Math.sin(-o+r.lambda-l)+n.D4410*Math.sin(2*o+2*r.lambda-h)+n.D4422*Math.sin(2*r.lambda-h)+n.D5220*Math.sin(o+r.lambda-d)+n.D5232*Math.sin(-o+r.lambda-d)+n.D5421*Math.sin(o+2*r.lambda-u)+n.D5433*Math.sin(-o+2*r.lambda-u),r.dlambdadt=r.n+r.dlambdadt0,r.dnddt=n.D2201*Math.cos(2*o+r.lambda-m)+n.D2211*Math.cos(r.lambda-m)+n.D3210*Math.cos(o+r.lambda-l)+n.D3222*Math.cos(-o+r.lambda-l)+n.D5220*Math.cos(o+r.lambda-d)+n.D5232*Math.cos(-o+r.lambda-d)+2*(n.D4410*Math.cos(2*o+2*r.lambda-h)+n.D4422*Math.cos(2*r.lambda-h)+n.D5421*Math.cos(o+2*r.lambda-u)+n.D5433*Math.cos(-o+2*r.lambda-u)),r.dnddt*=r.dlambdadt}if(Math.abs(r.minsAfterEpoch-n)<Math.abs(c))break;r.lambda+=r.dlambdadt*c+.5*r.dndt*i,r.n+=r.dndt*c+.5*r.dnddt*i,r.minsAfterEpoch+=c}const I=n-r.minsAfterEpoch,N=r.lambda+r.dlambdadt*I+.5*r.dndt*I**2,R=r.n+r.dndt*I+.5*r.dnddt*I**2;let C;return e.type==f.HALF_DAY_RESONANCE?C=(N-2*o.Omega+2*D)%(2*Math.PI):e.type==f.ONE_DAY_RESONANCE&&(C=(N-o.Omega-o.omega+D)%(2*Math.PI)),{M:C,n:R}}(t.tle,t.resonance,t.secGrav,a,e,t.integrationState),o.n<=0)throw{type:i.ERROR_MEAN_MOTION,message:"Mean motion "+o.n+" invalid!"};const n=Math.pow(c.xke/o.n,2/3)*Math.pow(1-t.dragTerms.C1[1]*e,2),r=c.xke/Math.pow(n,1.5),m=a.ecc-t.tle.dragTerm*t.dragTerms.C4*e;if(m>=1||m<-.001)throw{type:i.ERROR_MEAN_ECCENTRICITY,message:"Mean eccentricity "+m+" invalid!"};let u=(o.M+t.brouwer.meanMotionBrouwer*t.dragTerms.t2cof*e*e)%(2*Math.PI);const g={a:n,incl:a.incl,ecc:m,M:u,omega:a.omega,Omega:a.Omega,n:r},p=function(t,e,a,o,n,r){const c=t.jtUt1Epoch-2415020,i=4.7199672+.2299715*c-(5.8351514+.001944368*c),s=(6.2565837+.017201977*c+119459e-10*r)%(2*Math.PI),M=(i+.00015835218*r)%(2*Math.PI),m=t.eccentricity,l=e.meanMotionBrouwer,h=E(m,l,a,s,.01675,298647972e-14),d=E(m,l,o,M,.0549,4.796806521e-7),u=h.deltaecc+d.deltaecc,f=h.deltaI+d.deltaI,g=h.deltaM+d.deltaM,p=h.deltaomegaI+d.deltaomegaI,D=h.deltaOmegaI+d.deltaOmegaI,I=n.ecc+u,N=n.incl+f;let R,C,y;if(N>=.2){const t=D/Math.sin(N),e=p-Math.cos(N)*t;R=n.omega+e,C=n.Omega+t,y=n.M+g}else{const t=Math.sin(N)*Math.sin(n.Omega)+D*Math.cos(n.Omega)+f*Math.cos(N)*Math.sin(n.Omega),e=Math.sin(N)*Math.cos(n.Omega)-D*Math.sin(n.Omega)+f*Math.cos(N)*Math.cos(n.Omega);C=n.Omega%(2*Math.PI),C<0&&(C+=2*Math.PI);const a=(n.M+n.omega+Math.cos(N)*C+g+p-f*Math.sin(N)*C)%(2*Math.PI),o=C;C=Math.atan2(t,e),C<0&&(C+=2*Math.PI),Math.abs(C-o)>Math.PI&&(C<o?C+=2*Math.PI:C-=2*Math.PI),y=n.M+g,R=a-y-Math.cos(N)*C}return{a:n.a,n:n.n,ecc:I,incl:N,Omega:C,omega:R,M:y}}(t.tle,t.brouwer,t.thirdBodyCommon.sun,t.thirdBodyCommon.moon,g,e);if(p.incl<0&&(p.incl*=-1,p.Omega+=Math.PI,p.omega-=Math.PI),p.ecc<0||p.ecc>1)throw{type:i.ERROR_PERT_ECCENTRICITY,message:"Eccentricity "+p.ecc+" invalid!"};return d(h(t.tle,p,p.incl))}}return e})()));