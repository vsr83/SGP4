!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.sgp4=e():t.sgp4=e()}(self,(()=>(()=>{"use strict";var t={d:(e,a)=>{for(var o in a)t.o(a,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{createTarget:()=>D,propagateTarget:()=>I,propagateTargetJulian:()=>C,propagateTargetTs:()=>N,tleFromLines:()=>n});const a={FIELD_NUMBER:1,FIELD_NUMBER_IMPLIED:2,FIELD_NUMBER_MAPPED:3,FIELD_STRING:4},o=[{name:"title",fieldType:a.FIELD_STRING,row:0,startCol:0,endCol:23},{name:"catalogNumber",fieldType:a.FIELD_NUMBER,row:1,startCol:2,endCol:6},{name:"classification",fieldType:a.FIELD_STRING,row:1,startCol:7,endCol:7},{name:"intLaunchYear",fieldType:a.FIELD_STRING,row:1,startCol:9,endCol:10},{name:"intLaunchNum",fieldType:a.FIELD_STRING,row:1,startCol:11,endCol:13},{name:"intLaunchPiece",fieldType:a.FIELD_STRING,row:1,startCol:14,endCol:16},{name:"epochYear",fieldType:a.FIELD_NUMBER_MAPPED,row:1,startCol:18,endCol:19,callback:function(t){return t>56?1900+t:2e3+t}},{name:"epochFracDay",fieldType:a.FIELD_NUMBER,row:1,startCol:20,endCol:31},{name:"meanMotionDer",fieldType:a.FIELD_NUMBER,row:1,startCol:33,endCol:42},{name:"meanMotionDer2",fieldType:a.FIELD_NUMBER_IMPLIED,row:1,startCol:44,endCol:51},{name:"dragTerm",fieldType:a.FIELD_NUMBER_IMPLIED,row:1,startCol:53,endCol:60},{name:"ephemerisType",fieldType:a.FIELD_NUMBER,row:1,startCol:62,endCol:62},{name:"elementSetNo",fieldType:a.FIELD_NUMBER,row:1,startCol:64,endCol:67},{name:"checkSum1",fieldType:a.FIELD_NUMBER,row:1,startCol:68,endCol:68},{name:"catalogNumber2",fieldType:a.FIELD_NUMBER,row:2,startCol:2,endCol:6},{name:"inclination",fieldType:a.FIELD_NUMBER,row:2,startCol:8,endCol:15},{name:"raAscNode",fieldType:a.FIELD_NUMBER,row:2,startCol:17,endCol:24},{name:"eccentricity",fieldType:a.FIELD_NUMBER_IMPLIED,row:2,startCol:26,endCol:32},{name:"argPerigee",fieldType:a.FIELD_NUMBER,row:2,startCol:34,endCol:41},{name:"meanAnomaly",fieldType:a.FIELD_NUMBER,row:2,startCol:43,endCol:50},{name:"meanMotion",fieldType:a.FIELD_NUMBER,row:2,startCol:52,endCol:62},{name:"revNoAtEpoch",fieldType:a.FIELD_NUMBER,row:2,startCol:63,endCol:67},{name:"checkSum2",fieldType:a.FIELD_NUMBER,row:2,startCol:68,endCol:68}];function n(t){const e={},n={};for(let e=0;e<o.length;e++){const r=o[e],c=t[r.row].substring(r.startCol,r.endCol+1);switch(r.fieldType){case a.FIELD_STRING:n[r.name]=c;break;case a.FIELD_NUMBER:n[r.name]=Number(c);break;case a.FIELD_NUMBER_IMPLIED:"-"==c[0]?n[r.name]=-Number("0."+c.substring(1).replace("-","e-").replace("+","e").replace(" ","")):n[r.name]=Number("0."+c.replace("-","e-").replace("+","e").replace(" ",""));break;case a.FIELD_NUMBER_MAPPED:r.callback&&(n[r.name]=r.callback(Number(c)))}}return function(t){e.title=t.title,e.catalogNumber=t.catalogNumber,e.classification=t.classification,e.intLaunchYear=t.intLaunchYear,e.intLaunchNum=t.intLaunchNum,e.intLaunchPiece=t.intLaunchPiece,e.epochYear=t.epochYear,e.epochFracDay=t.epochFracDay,e.meanMotionDer=t.meanMotionDer,e.meanMotionDer2=t.meanMotionDer2,e.dragTerm=t.dragTerm,e.ephemerisType=t.ephemerisType,e.elementSetNo=t.elementSetNo,e.checkSum1=t.checkSum1,e.catalogNumber2=t.catalogNumber2,e.inclination=t.inclination,e.raAscNode=t.raAscNode,e.eccentricity=t.eccentricity,e.argPerigee=t.argPerigee,e.meanAnomaly=t.meanAnomaly,e.meanMotion=t.meanMotion,e.revNoAtEpoch=t.revNoAtEpoch,e.checkSum2=t.checkSum2}(n),e.checkSumValid=r(t[1])==e.checkSum1&&r(t[2])==e.checkSum2,e.jtUt1Epoch=function(t,e){const a=[31,t%4==0?29:28,31,30,31,30,31,31,30,31,30,31],o=Math.floor(e);let n=0,r=0;for(n=0;n<12;n++){const t=a[n];if(o-r-t<0)break;r+=t}const i=o-r,s=e-o,M=Math.floor(24*s),l=Math.floor(1440*(s-M/24));return c(t,n+1,i,M,l,86400*(s-M/24-l/1440))}(e.epochYear,e.epochFracDay),e}function r(t){let e=0;const a=t.substring(0,68);for(let t=0;t<a.length;t++){const o=a[t];"0123456789".indexOf(o)>-1?e+=parseInt(o):"-"==o&&e++}return e%10}function c(t,e,a,o,n,r){const c=function(t,e,a){e<3&&(t--,e+=12);const o=Math.floor(t/100),n=Math.floor(o/4);return Math.floor(2-o+n)+a+Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))-1524.5}(t,e,a);return c+o/24+n/1440+r/86400}const i={mu:398600.8,radiusEarthKm:6378.135,xke:.07436691613317342,tumin:13.44683969695931,j2:.001082616,j3:-253881e-11,j4:-165597e-11},s={ERROR_NONE:0,ERROR_MEAN_ECCENTRICITY:1,ERROR_MEAN_MOTION:2,ERROR_PERT_ECCENTRICITY:3,ERROR_SEMI_LATUS_RECTUM:4,ERROR_EPOCH_SUBORBITAL:5,ERROR_SATELLITE_DECAYED:6,ERROR_INVALID_TSINCE:7};function M(t){const e=(t-2451545)/36525,a=2*Math.PI;let o=-62e-7*e*e*e+.093104*e*e+3164400184.812866*e+67310.54841;return o=o*Math.PI/43200%a,o<0&&(o+=a),o}function l(t){return 2*Math.PI*t/360}function m(t,e){const a=[];let o=1;a.push(o);for(let n=1;n<=e;n++)o*=t,a.push(o);return a}function h(t,e,a,o){const n=l(t.meanAnomaly),r=l(t.argPerigee),c=l(t.raAscNode);return{a:e.semiMajorAxisBrouwer,incl:l(t.inclination),ecc:t.eccentricity,M:n+a.MDot*o,omega:r+a.omegaDot*o,Omega:c+a.OmegaDot*o}}function d(t,e,a){const o=-i.j3,n=.5*i.j2,r=Math.sqrt(1-e.ecc**2);let c=l(t.inclination);void 0!==a&&(c=a);const M=Math.cos(c),m=o*Math.sin(e.incl)/(4*n*e.a*r*r),h=e.ecc*Math.cos(e.omega),d=e.M+e.omega+e.Omega+.5*m*h*(3+5*M)/(1+M),u=e.ecc*Math.sin(e.omega)+m,E=function(t){const e=2*Math.PI;return t-e*Math.floor(t/e)}(d-e.Omega);let g=E,f=1e-12+1,p=0;for(;p<=10&&Math.abs(f)>1e-12;)f=-(E-u*Math.cos(g)+h*Math.sin(g)-g)/(u*Math.sin(g)+h*Math.cos(g)-1),Math.abs(f)>=.95&&(f=.95*Math.sign(f)),g+=f,p++;const D=h*Math.cos(g)+u*Math.sin(g),I=h*Math.sin(g)-u*Math.cos(g),C=Math.atan2(I,D),N=Math.sqrt(h*h+u*u),R=e.a*(1-N*N);if(R<0)throw{type:s.ERROR_SEMI_LATUS_RECTUM,message:"Semi-latus rectum "+R+" negative!"};const y=e.a*(1-N*Math.cos(C)),O=e.a/y*(Math.cos(g)-h+u*I/(1+Math.sqrt(1-N**2))),T=e.a/y*(Math.sin(g)-u-h*I/(1+Math.sqrt(1-N**2))),b=Math.atan2(T,O),_=Math.sqrt(e.a)*I/y,w=Math.sqrt(R)/y,A=Math.pow(e.a,-1.5),P=Math.sin(2*b),B=Math.cos(2*b),L=M**2,S=.5*n*(1-L)*B/R,Z=-.25*n*(7*L-1)*P/(R*R),F=1.5*n*M*P/(R*R),U=1.5*n*M*Math.sin(e.incl)*B/(R*R),v=-n*A*(1-L)*P/R,j=n*A*((1-L)*B-1.5*(1-3*L))/R,k=y*(1-1.5*n*Math.sqrt(1-N**2)*(3*L-1)/R**2)+S,Y=b+Z,x=e.Omega+F,X=e.incl+U,q=_+v,G=w+j;if(k<1)throw{type:s.ERROR_SATELLITE_DECAYED,message:"Satellite orbit decayed!"};return{r:k,u:Y,Omega:x,incl:X,rdot:q,rfdot:G}}function u(t){const e=-Math.sin(t.Omega)*Math.cos(t.incl),a=Math.cos(t.Omega)*Math.cos(t.incl),o=Math.sin(t.incl),n=Math.cos(t.Omega),r=Math.sin(t.Omega),c=e*Math.sin(t.u)+n*Math.cos(t.u),s=a*Math.sin(t.u)+r*Math.cos(t.u),M=o*Math.sin(t.u)+0*Math.cos(t.u),l=e*Math.cos(t.u)-n*Math.sin(t.u),m=a*Math.cos(t.u)-r*Math.sin(t.u),h=o*Math.cos(t.u)-0*Math.sin(t.u),d=i.radiusEarthKm*i.xke/60;return{r:[t.r*c*i.radiusEarthKm,t.r*s*i.radiusEarthKm,t.r*M*i.radiusEarthKm],v:[(t.rdot*c+t.rfdot*l)*d,(t.rdot*s+t.rfdot*m)*d,(t.rdot*M+t.rfdot*h)*d]}}function E(t,e,a,o,n,r,c){const i=Math.cos(n),s=Math.sin(n),M=Math.cos(r),l=Math.sin(r),m=Math.cos(e),h=Math.sin(e),d=Math.cos(a),u=Math.sin(a),E=Math.cos(o-c),g=Math.sin(o-c),f=M*E+l*i*g,p=-l*E+M*i*g,D=-M*g+l*i*E,I=l*s,C=l*g+M*i*E,N=M*s,R=D*m+I*h,y=C*m+N*h,O=-D*h+I*m,T=-C*h+N*m,b=f*d+R*u,_=p*d+y*u,w=-f*u+R*d,A=-p*u+y*d,P=O*u,B=T*u,L=O*d,S=T*d,Z=t*t,F=12*b*b-3*w*w,U=24*b*_-6*w*A,v=12*_*_-3*A*A;return{a1:f,a2:R,a3:p,a4:y,a5:O,a6:T,a7:D,a8:I,a9:C,a10:N,X1:b,X2:_,X3:w,X4:A,X5:P,X6:B,X7:L,X8:S,Z1:6*(f*f+R*R)+(1+Z)*F,Z2:12*(f*p+R*y)+(1+Z)*U,Z3:6*(p*p+y*y)+(1+Z)*v,Z11:-6*f*O+Z*(-24*b*L-6*w*P),Z12:-6*f*T-6*p*O-Z*(24*_*L+24*b*S+6*w*B+6*A*P),Z13:-6*p*T+Z*(-24*_*S-6*A*B),Z21:6*R*O+Z*(24*b*P-6*w*L),Z22:6*y*O+6*R*T+Z*(24*_*P+24*b*B-6*A*L-6*w*S),Z23:6*y*T+Z*(24*_*B-6*A*S),Z31:F,Z32:U,Z33:v}}function g(t,e,a,o,n,r){const c=o+2*n*Math.sin(o),i=.5*Math.sin(c)*Math.sin(c)-.25,s=-.5*Math.sin(c)*Math.cos(c),M=Math.sqrt(1-t*t);return{deltaecc:-30*M*r*t/e*(i*(a.X2*a.X3+a.X1*a.X4)+s*(a.X2*a.X4-a.X1*a.X3)),deltaI:-r/(e*M)*(i*a.Z12+s*(a.Z13-a.Z11)),deltaM:-2*r/e*(i*a.Z2+s*(a.Z3-a.Z1)-3*n*Math.sin(c)*(7+3*t*t)),deltaomegaI:2*M*r/e*(i*a.Z32+s*(a.Z33-a.Z31)-9*n*Math.sin(c)),deltaOmegaI:r/(e*M)*(i*a.Z22+s*(a.Z23-a.Z21))}}const f={NO_RESONANCE:1,ONE_DAY_RESONANCE:2,HALF_DAY_RESONANCE:3};const p={SGP4:1,SDP4:2};function D(t){const e={};var a;return e.tle=t,e.brouwer=function(t){const e=l(t.inclination),a=1440/(2*Math.PI),o=1-t.eccentricity*t.eccentricity,n=Math.cos(e),r=t.meanMotion/a,c=Math.pow(i.xke/r,2/3),s=.75*i.j2*(3*n*n-1)/(Math.sqrt(o)*o);let M=s/(c*c);const m=c*(1-M*(1/3+M*(1+134/81*M)));M=s/(m*m);const h=r/(1+M);return{meanMotionBrouwer:h,semiMajorAxisBrouwer:Math.pow(i.xke/h,2/3)}}(t),e.secGrav=function(t,e){const a=l(t.inclination),o=m(Math.cos(a),4),n=m(e.semiMajorAxisBrouwer*i.radiusEarthKm,4),r=m(Math.sqrt(1-t.eccentricity*t.eccentricity),8),c=m(i.radiusEarthKm,4),s=.5*c[2]*i.j2,M=-.375*c[4]*i.j4;let h=1+1.5*s*(3*o[2]-1)/(n[2]*r[3])+.1875*s*s*(13-78*o[2]+137*o[4])/(n[4]*r[7]),d=1.5*s*(5*o[2]-1)/(n[2]*r[4])+.1875*s*s*(7-114*o[2]+395*o[4])/(n[4]*r[8])+1.25*M*(3-36*o[2]+49*o[4])/(n[4]*r[8]),u=-3*s*o[1]/(n[2]*r[4])+1.5*s*s*(4*o[1]-19*o[3])/(n[4]*r[8])+2.5*M*(3*o[1]-7*o[3])/(n[4]*r[8]);return h*=e.meanMotionBrouwer,d*=e.meanMotionBrouwer,u*=e.meanMotionBrouwer,{MDot:h,omegaDot:d,OmegaDot:u}}(t,e.brouwer),e.dragTerms=function(t,e){const a=e.semiMajorAxisBrouwer*(1-t.eccentricity);let o=!1;a<220/i.radiusEarthKm+1&&(o=!0);const n=(a-1)*i.radiusEarthKm;let r;r=n<98?20:n<156?n-78:78;const c=r/i.radiusEarthKm+1,s=Math.pow((120-r)/i.radiusEarthKm,4),M=t.eccentricity,h=e.semiMajorAxisBrouwer,d=e.meanMotionBrouwer,u=l(t.argPerigee),E=l(t.inclination),g=m(1/(h-c),5),f=m(h*M*g[1],8),p=m(Math.sqrt(1-M*M),2),D=m(Math.cos(E),2),I=-i.j3,C=.5*i.j2;let N=s*g[4]*d*Math.pow(1-f[2],-3.5)*(h*(1+1.5*f[2]+M*(4*f[1]+f[3]))+1.5*C*g[1]/(1-f[2])*(1.5*D[2]-.5)*(8+24*f[2]+3*f[4]));const R=m(t.dragTerm*N,4);let y=0;M>1e-4&&(y=s*g[5]*I*d*Math.sin(E)/(C*M));const O=2*d*s*g[4]*h*p[2]*Math.pow(1-f[2],-3.5)*(2*f[1]*(1+M*f[1])+.5*M+.5*f[3]-2*C*g[1]/(h*(1-f[2]))*(3*(1-3*D[2])*(1+1.5*f[2]-2*M*f[1]-.5*M*f[3])+.75*(1-D[2])*(2*f[2]-M*f[1]-M*f[3])*Math.cos(2*u))),T=2*s*g[4]*h*p[2]*Math.pow(1-f[2],-3.5)*(1+2.75*f[1]*(f[1]+M)+M*f[3]),b=4*h*g[1]*R[2],_=4/3*h*g[2]*(17*h+c)*R[3],w=2/3*h*h*g[3]*(221*h+31*c)*R[4];return{C1:R,C2:N,C3:y,C4:O,C5:T,D2:b,D3:_,D4:w,t2cof:1.5*R[1],t3cof:b+2*R[2],t4cof:.25*(3*_+12*R[1]*b+10*R[3]),t5cof:.2*(3*w+12*R[1]*_+6*b**2+30*R[2]*b+15*R[4]),qs4Term:s,s:c,xi:g,eta:f,beta0:p,theta:D,useSimplifiedDrag:o}}(t,e.brouwer),a=e.brouwer,2*Math.PI/a.meanMotionBrouwer<225?e.solverType=p.SGP4:(e.solverType=p.SDP4,e.thirdBodyCommon=function(t,e){const a=l(281.2208026160437),o=298647972e-14,n=4.796806521e-7,r=119459e-10,c=.00015835218,i=l(23.444100086478358),s=l(t.raAscNode),M=l(t.inclination),m=l(t.argPerigee),h=t.eccentricity,d=e.meanMotionBrouwer,u=Math.sqrt(1-h*h),g=t.jtUt1Epoch-2415020,f=(4.523602-.00092422029*g)%(2*Math.PI),p=5.8351514+.001944368*g,D=l(5.145400276825767),I=Math.cos(i)*Math.cos(D)-Math.sin(i)*Math.sin(D)*Math.cos(f),C=Math.sqrt(1-I**2),N=Math.atan2(C,I),R=Math.sin(D)*Math.sin(f)/Math.sin(N),y=Math.sqrt(1-R**2),O=Math.atan2(R,y),T=Math.sin(i)*Math.sin(f)/Math.sin(N),b=Math.cos(O)*Math.cos(f)+Math.sin(O)*Math.sin(f)*Math.cos(i),_=p-f+Math.atan2(T,b),w=E(h,M,m,s,i,a,0),A=E(h,M,m,s,N,_,O),P=-15*o*r*h/d*u*(w.X1*w.X3+w.X2*w.X4),B=-15*n*c*h/d*u*(A.X1*A.X3+A.X2*A.X4),L=-.5*o*r/u/d*(w.Z11+w.Z13),S=-.5*n*c/u/d*(A.Z11+A.Z13),Z=-o*r/d*(w.Z1+w.Z3-14-6*h*h),F=-n*c/d*(A.Z1+A.Z3-14-6*h*h);let U,v,j,k;return t.inclination<3?(U=0,v=0):(U=o*r/(2*d*u*Math.sin(M))*(w.Z21+w.Z23),v=n*c/(2*d*u*Math.sin(M))*(A.Z21+A.Z23)),t.inclination<3?(j=o*r*u/d*(w.Z31+w.Z33-6),k=n*c*u/d*(A.Z31+A.Z33-6)):(j=o*r*u/d*(w.Z31+w.Z33-6)-U*Math.cos(M),k=n*c*u/d*(A.Z31+A.Z33-6)-v*Math.cos(M)),{sun:w,moon:A,secularRates:{dedt:P+B,dIdt:L+S,dMdt:Z+F,dOmegadt:U+v,domegadt:j+k}}}(t,e.brouwer),e.resonance=function(t,e){let a,o=f.NO_RESONANCE;return e.meanMotionBrouwer>.0034906585&&e.meanMotionBrouwer<.0052359877&&(o=f.ONE_DAY_RESONANCE,a=function(t,e){const a=l(t.inclination),o=Math.cos(a),n=Math.sin(a),r=t.eccentricity,c=e.meanMotionBrouwer,i=e.semiMajorAxisBrouwer;return{delta1:3*c**2/i**3*(.9375*n**2*(1+3*o)-.75*(1+o))*(1+2*r**2)*21460748e-13,delta2:6*c**2/i**2*(.75*Math.pow(1+o,2))*(1-2.5*r**2+.8125*r**4)*17891679e-13,delta3:9*c**2/i**3*(1.875*Math.pow(1+o,3))*(1-6*r**2+6.60937*r**4)*2.2123015e-7}}(t,e)),e.meanMotionBrouwer>=.00826&&e.meanMotionBrouwer<=.00924&&t.eccentricity>=.5&&(o=f.HALF_DAY_RESONANCE,a=function(t,e){const a=t.eccentricity,o=a*a,n=o*a,r=l(t.inclination),c=Math.sin(r),i=c*c,s=Math.cos(r),M=s*s,m=-.306-.44*(a-.64);let h,d,u,E,g,f,p,D,I;a<=.65?(h=3.616-13.247*a+16.29*o,d=117.39*a-19.302-228.419*o+156.591*n,u=109.7927*a-18.9068-214.6334*o+146.5816*n,E=242.694*a-41.122-471.094*o+313.953*n,g=841.88*a-146.407-1629.014*o+1083.435*n,f=3017.977*a-532.114-5740.032*o+3708.276*n):(h=331.819*a-72.099-508.738*o+266.724*n,d=1582.851*a-346.844-2415.925*o+1246.113*n,u=1554.908*a-342.585-2366.899*o+1215.972*n,E=4758.686*a-1052.797-7193.992*o+3651.957*n,g=16178.11*a-3581.69-24462.77*o+12422.52*n,f=a>.715?29936.92*a-5149.66-54087.36*o+31324.56*n:1464.74-4664.75*a+3763.64*o),a<.7?(I=4988.61*a-919.2277-9064.77*o+5542.21*n,p=4568.6173*a-822.71072-8491.4146*o+5337.524*n,D=4690.25*a-853.666-8624.77*o+5341.4*n):(I=161616.52*a-37995.78-229838.2*o+109377.94*n,p=218913.95*a-51752.104-309468.16*o+146349.42*n,D=170470.89*a-40023.88-242699.48*o+115605.82*n);const C=.75*(1+2*s+M),N=1.5*i,R=1.875*c*(1-2*s-3*M),y=-1.875*c*(1+2*s-3*M),O=35*i*C,T=39.375*i*i,b=9.84375*c*(i*(1-2*s-5*M)+.33333333*(4*s-2+6*M)),_=c*(4.92187512*i*(-2-4*s+10*M)+6.56250012*(1+2*s-3*M)),w=29.53125*c*(2-8*s+M*(8*s-12+10*M)),A=29.53125*c*(-2-8*s+M*(12+8*s-10*M)),P=17891679e-13,B=3.7393792e-7,L=7.3636953e-9,S=1.1428639e-7,Z=2.1765803e-9,F=e.meanMotionBrouwer,U=e.semiMajorAxisBrouwer,v=F*F*3;return{D2201:v/U**2*P*C*m,D2211:v/U**2*P*N*h,D3210:v/U**3*B*R*d,D3222:v/U**3*B*y*u,D4410:v/U**4*2*L*O*E,D4422:v/U**4*2*L*T*g,D5220:v/U**5*S*b*f,D5232:v/U**5*S*_*D,D5421:v/U**5*2*Z*w*p,D5433:v/U**5*2*Z*A*I}}(t,e)),{type:o,coeffs:a}}(t,e.brouwer),e.integrationState=function(t,e,a,o,n){const r=l(t.meanAnomaly),c=l(t.raAscNode),i=l(t.argPerigee),s=M(t.jtUt1Epoch),m=.0043752690880113;let h,d,u;return n==f.HALF_DAY_RESONANCE?(h=(r+2*c-2*s)%(2*Math.PI),d=o.MDot+a.dMdt+2*(o.OmegaDot+a.dOmegadt-m)-e.meanMotionBrouwer,u=e.meanMotionBrouwer):n==f.ONE_DAY_RESONANCE&&(h=(r+c+i-s)%(2*Math.PI),d=o.MDot+a.dMdt+o.OmegaDot+a.dOmegadt+o.omegaDot+a.domegadt-m-e.meanMotionBrouwer,u=e.meanMotionBrouwer),{minsAfterEpoch:0,lambda:h,lambda0:h,dlambdadt:d,dlambdadt0:d,n:u,n0:u,dndt:0}}(t,e.brouwer,e.thirdBodyCommon.secularRates,e.secGrav,e.resonance.type),e.dragTerms.useSimplifiedDrag=!0),e}function I(t,e,a){if("number"!=typeof e)throw{type:s.ERROR_INVALID_TSINCE,message:"tSince parameter "+e+" not a number!"};void 0===a&&(a=0);const o=60*(e-t.lastTime);if(void 0===t.lastTime);else if(Math.abs(o)<a)return{r:[t.lastOsv.r[0]+t.lastOsv.v[0]*o,t.lastOsv.r[1]+t.lastOsv.v[1]*o,t.lastOsv.r[2]+t.lastOsv.v[2]*o],v:t.lastOsv.v};let n;if(t.solverType==p.SGP4){const a=h(t.tle,t.brouwer,t.secGrav,e),o=function(t,e,a,o,n){const{C1:r,C2:c,C3:s,C4:M,C5:h,D2:d,D3:u,D4:E,qs4Term:g,s:f,t2cof:p,t3cof:D,t4cof:I,t5cof:C,xi:N,eta:R,beta0:y,theta:O,useSimplifiedDrag:T}=o,b=(l(t.meanAnomaly),l(t.argPerigee)),_=l(t.meanAnomaly),w=t.eccentricity,A=m(e.semiMajorAxisBrouwer,2),P=e.meanMotionBrouwer,B=m(n,5),L=(l(t.inclination),.5*i.j2),S=t.dragTerm;let Z,F,U,v,j,k;if(T){Z=a.M,F=a.omega,U=a.Omega-P*L*O[1]*10.5/(A[2]*y[2])*r[1]*B[2],v=t.eccentricity-S*M*B[1],v<1e-6&&(v=1e-6);const o=e.meanMotionBrouwer;j=Math.pow(i.xke/o,2/3)*Math.pow(1-r[1]*B[1],2),k=Z+F+U+P*(p*B[2])}else{const o=t.dragTerm*s*Math.cos(b)*n;let c=-2/3*g*t.dragTerm*N[4]/(R[1]*w)*(Math.pow(1+R[1]*Math.cos(a.M),3)-Math.pow(1+R[1]*Math.cos(_),3));t.eccentricity<=1e-4&&(c=0),Z=a.M+o+c,F=a.omega-o-c,U=a.Omega-P*L*O[1]*10.5/(A[2]*y[2])*r[1]*B[2],v=t.eccentricity-S*M*B[1]-S*h*(Math.sin(Z)-Math.sin(_)),v<1e-6&&(v=1e-6);const l=e.meanMotionBrouwer;j=Math.pow(i.xke/l,2/3)*Math.pow(1-r[1]*B[1]-d*B[2]-u*B[3]-E*B[4],2),k=Z+F+U+P*(p*B[2]+D*B[3]+I*B[4]+C*B[5])}return k%=2*Math.PI,Z=(k-F-U)%(2*Math.PI),{a:j,incl:a.incl,ecc:v,M:Z,omega:F,Omega:U,L:k}}(t.tle,t.brouwer,a,t.dragTerms,e);if(o.ecc>=1||o.ecc<-.001)throw{type:s.ERROR_PERT_ECCENTRICITY,message:"Eccentricity "+kepler4.ecc+" invalid!"};n=u(d(t.tle,o))}else{const a=function(t,e,a){return{a:t.a,incl:t.incl+a*e.dIdt,ecc:t.ecc+a*e.dedt,M:t.M+a*e.dMdt,omega:t.omega+a*e.domegadt,Omega:t.Omega+a*e.dOmegadt}}(h(t.tle,t.brouwer,t.secGrav,e),t.thirdBodyCommon.secularRates,e);let o;if(o=t.resonance.type==f.NO_RESONANCE?{M:a.M,n:i.xke/Math.pow(a.a,1.5)}:function(t,e,a,o,n,r){let c=720,i=c*c;n-r.minsAfterEpoch<0&&(c=-c);const s=5.7686396,m=.95240898,h=1.8014998,d=1.050833,u=4.4108898,E=.13130908,g=2.8843198,p=.37448087,D=(M(t.jtUt1Epoch)+.0043752690880113*n)%(2*Math.PI);for(;;){if(e.type==f.ONE_DAY_RESONANCE){const t=e.coeffs;r.dndt=t.delta1*Math.sin(r.lambda-E)+t.delta2*Math.sin(2*(r.lambda-g))+t.delta3*Math.sin(3*(r.lambda-p)),r.dlambdadt=r.n+r.dlambdadt0,r.dnddt=t.delta1*Math.cos(r.lambda-E)+2*t.delta2*Math.cos(2*(r.lambda-g))+3*t.delta3*Math.cos(3*(r.lambda-p)),r.dnddt*=r.dlambdadt}else if(e.type==f.HALF_DAY_RESONANCE){const o=l(t.argPerigee)+a.omegaDot*r.minsAfterEpoch,n=e.coeffs;r.dndt=n.D2201*Math.sin(2*o+r.lambda-s)+n.D2211*Math.sin(r.lambda-s)+n.D3210*Math.sin(o+r.lambda-m)+n.D3222*Math.sin(-o+r.lambda-m)+n.D4410*Math.sin(2*o+2*r.lambda-h)+n.D4422*Math.sin(2*r.lambda-h)+n.D5220*Math.sin(o+r.lambda-d)+n.D5232*Math.sin(-o+r.lambda-d)+n.D5421*Math.sin(o+2*r.lambda-u)+n.D5433*Math.sin(-o+2*r.lambda-u),r.dlambdadt=r.n+r.dlambdadt0,r.dnddt=n.D2201*Math.cos(2*o+r.lambda-s)+n.D2211*Math.cos(r.lambda-s)+n.D3210*Math.cos(o+r.lambda-m)+n.D3222*Math.cos(-o+r.lambda-m)+n.D5220*Math.cos(o+r.lambda-d)+n.D5232*Math.cos(-o+r.lambda-d)+2*(n.D4410*Math.cos(2*o+2*r.lambda-h)+n.D4422*Math.cos(2*r.lambda-h)+n.D5421*Math.cos(o+2*r.lambda-u)+n.D5433*Math.cos(-o+2*r.lambda-u)),r.dnddt*=r.dlambdadt}if(Math.abs(r.minsAfterEpoch-n)<Math.abs(c))break;r.lambda+=r.dlambdadt*c+.5*r.dndt*i,r.n+=r.dndt*c+.5*r.dnddt*i,r.minsAfterEpoch+=c}const I=n-r.minsAfterEpoch,C=r.lambda+r.dlambdadt*I+.5*r.dndt*I**2,N=r.n+r.dndt*I+.5*r.dnddt*I**2;let R;return e.type==f.HALF_DAY_RESONANCE?R=(C-2*o.Omega+2*D)%(2*Math.PI):e.type==f.ONE_DAY_RESONANCE&&(R=(C-o.Omega-o.omega+D)%(2*Math.PI)),{M:R,n:N}}(t.tle,t.resonance,t.secGrav,a,e,t.integrationState),o.n<=0)throw{type:s.ERROR_MEAN_MOTION,message:"Mean motion "+o.n+" invalid!"};const r=Math.pow(i.xke/o.n,2/3)*Math.pow(1-t.dragTerms.C1[1]*e,2),c=i.xke/Math.pow(r,1.5),m=a.ecc-t.tle.dragTerm*t.dragTerms.C4*e;if(m>=1||m<-.001)throw{type:s.ERROR_MEAN_ECCENTRICITY,message:"Mean eccentricity "+m+" invalid!"};let E=(o.M+t.brouwer.meanMotionBrouwer*t.dragTerms.t2cof*e*e)%(2*Math.PI);const p={a:r,incl:a.incl,ecc:m,M:E,omega:a.omega,Omega:a.Omega,n:c},D=function(t,e,a,o,n,r){const c=t.jtUt1Epoch-2415020,i=4.7199672+.2299715*c-(5.8351514+.001944368*c),s=(6.2565837+.017201977*c+119459e-10*r)%(2*Math.PI),M=(i+.00015835218*r)%(2*Math.PI),l=t.eccentricity,m=e.meanMotionBrouwer,h=g(l,m,a,s,.01675,298647972e-14),d=g(l,m,o,M,.0549,4.796806521e-7),u=h.deltaecc+d.deltaecc,E=h.deltaI+d.deltaI,f=h.deltaM+d.deltaM,p=h.deltaomegaI+d.deltaomegaI,D=h.deltaOmegaI+d.deltaOmegaI,I=n.ecc+u,C=n.incl+E;let N,R,y;if(C>=.2){const t=D/Math.sin(C),e=p-Math.cos(C)*t;N=n.omega+e,R=n.Omega+t,y=n.M+f}else{const t=Math.sin(C)*Math.sin(n.Omega)+D*Math.cos(n.Omega)+E*Math.cos(C)*Math.sin(n.Omega),e=Math.sin(C)*Math.cos(n.Omega)-D*Math.sin(n.Omega)+E*Math.cos(C)*Math.cos(n.Omega);R=n.Omega%(2*Math.PI),R<0&&(R+=2*Math.PI);const a=(n.M+n.omega+Math.cos(C)*R+f+p-E*Math.sin(C)*R)%(2*Math.PI),o=R;R=Math.atan2(t,e),R<0&&(R+=2*Math.PI),Math.abs(R-o)>Math.PI&&(R<o?R+=2*Math.PI:R-=2*Math.PI),y=n.M+f,N=a-y-Math.cos(C)*R}return{a:n.a,n:n.n,ecc:I,incl:C,Omega:R,omega:N,M:y}}(t.tle,t.brouwer,t.thirdBodyCommon.sun,t.thirdBodyCommon.moon,p,e);if(D.incl<0&&(D.incl*=-1,D.Omega+=Math.PI,D.omega-=Math.PI),D.ecc<0||D.ecc>1)throw{type:s.ERROR_PERT_ECCENTRICITY,message:"Eccentricity "+D.ecc+" invalid!"};n=u(d(t.tle,D,D.incl))}return t.lastTime=e,t.lastOsv=n,n}function C(t,e,a){return I(t,1440*(e-t.tle.jtUt1Epoch),a)}function N(t,e,a){return C(t,c(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()+.001*e.getUTCMilliseconds()),a)}return e})()));