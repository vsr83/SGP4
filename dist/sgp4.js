!function(e,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.sgp4=a():e.sgp4=a()}(self,(()=>(()=>{"use strict";var e={d:(a,t)=>{for(var o in t)e.o(t,o)&&!e.o(a,o)&&Object.defineProperty(a,o,{enumerable:!0,get:t[o]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},a={};e.r(a),e.d(a,{propagateTarget:()=>f,tleFromLines:()=>n});const t={FIELD_NUMBER:1,FIELD_NUMBER_IMPLIED:2,FIELD_NUMBER_MAPPED:3,FIELD_STRING:4},o=[{name:"title",fieldType:t.FIELD_STRING,row:0,startCol:0,endCol:23},{name:"catalogNumber",fieldType:t.FIELD_NUMBER,row:1,startCol:2,endCol:6},{name:"classification",fieldType:t.FIELD_STRING,row:1,startCol:7,endCol:7},{name:"intLaunchYear",fieldType:t.FIELD_STRING,row:1,startCol:9,endCol:10},{name:"intLaunchNum",fieldType:t.FIELD_STRING,row:1,startCol:11,endCol:13},{name:"intLaunchPiece",fieldType:t.FIELD_STRING,row:1,startCol:14,endCol:16},{name:"epochYear",fieldType:t.FIELD_NUMBER_MAPPED,row:1,startCol:18,endCol:19,callback:function(e){return e>56?1900+e:2e3+e}},{name:"epochFracDay",fieldType:t.FIELD_NUMBER,row:1,startCol:20,endCol:31},{name:"meanMotionDer",fieldType:t.FIELD_NUMBER,row:1,startCol:33,endCol:42},{name:"meanMotionDer2",fieldType:t.FIELD_NUMBER_IMPLIED,row:1,startCol:44,endCol:51},{name:"dragTerm",fieldType:t.FIELD_NUMBER_IMPLIED,row:1,startCol:53,endCol:60},{name:"ephemerisType",fieldType:t.FIELD_NUMBER,row:1,startCol:62,endCol:62},{name:"elementSetNo",fieldType:t.FIELD_NUMBER,row:1,startCol:64,endCol:67},{name:"checkSum1",fieldType:t.FIELD_NUMBER,row:1,startCol:68,endCol:68},{name:"catalogNumber2",fieldType:t.FIELD_NUMBER,row:2,startCol:2,endCol:6},{name:"inclination",fieldType:t.FIELD_NUMBER,row:2,startCol:8,endCol:15},{name:"raAscNode",fieldType:t.FIELD_NUMBER,row:2,startCol:17,endCol:24},{name:"eccentricity",fieldType:t.FIELD_NUMBER_IMPLIED,row:2,startCol:26,endCol:32},{name:"argPerigee",fieldType:t.FIELD_NUMBER,row:2,startCol:34,endCol:41},{name:"meanAnomaly",fieldType:t.FIELD_NUMBER,row:2,startCol:43,endCol:50},{name:"meanMotion",fieldType:t.FIELD_NUMBER,row:2,startCol:52,endCol:62},{name:"revNoAtEpoch",fieldType:t.FIELD_NUMBER,row:2,startCol:63,endCol:67},{name:"checkSum2",fieldType:t.FIELD_NUMBER,row:2,startCol:68,endCol:68}];function n(e){const a={},n={};for(let a=0;a<o.length;a++){const r=o[a],c=e[r.row].substring(r.startCol,r.endCol+1);switch(r.fieldType){case t.FIELD_STRING:n[r.name]=c;break;case t.FIELD_NUMBER:n[r.name]=Number(c);break;case t.FIELD_NUMBER_IMPLIED:"-"==c[0]?n[r.name]=-Number("0."+c.substring(1).replace("-","e-").replace("+","e").replace(" ","")):n[r.name]=Number("0."+c.replace("-","e-").replace("+","e").replace(" ",""));break;case t.FIELD_NUMBER_MAPPED:r.callback&&(n[r.name]=r.callback(Number(c)))}}return function(e){a.title=e.title,a.catalogNumber=e.catalogNumber,a.classification=e.classification,a.intLaunchYear=e.intLaunchYear,a.intLaunchNum=e.intLaunchNum,a.intLaunchPiece=e.intLaunchPiece,a.epochYear=e.epochYear,a.epochFracDay=e.epochFracDay,a.meanMotionDer=e.meanMotionDer,a.meanMotionDer2=e.meanMotionDer2,a.dragTerm=e.dragTerm,a.ephemerisType=e.ephemerisType,a.elementSetNo=e.elementSetNo,a.checkSum1=e.checkSum1,a.catalogNumber2=e.catalogNumber2,a.inclination=e.inclination,a.raAscNode=e.raAscNode,a.eccentricity=e.eccentricity,a.argPerigee=e.argPerigee,a.meanAnomaly=e.meanAnomaly,a.meanMotion=e.meanMotion,a.revNoAtEpoch=e.revNoAtEpoch,a.checkSum2=e.checkSum2}(n),a.checkSumValid=r(e[1])==a.checkSum1&&r(e[2])==a.checkSum2,a.jtUt1Epoch=function(e,a){const t=[31,e%4==0?29:28,31,30,31,30,31,31,30,31,30,31],o=Math.floor(a);let n=0,r=0;for(n=0;n<12;n++){const e=t[n];if(o-r-e<0)break;r+=e}const c=o-r,i=a-o,l=Math.floor(24*i),s=Math.floor(1440*(i-l/24));return function(e,a,t,o,n,r){const c=function(e,a,t){a<3&&(e--,a+=12);const o=Math.floor(e/100),n=Math.floor(o/4);return Math.floor(2-o+n)+t+Math.floor(365.25*(e+4716))+Math.floor(30.6001*(a+1))-1524.5}(e,a,t);return c+o/24+n/1440+r/86400}(e,n+1,c,l,s,86400*(i-l/24-s/1440))}(a.epochYear,a.epochFracDay),a}function r(e){let a=0;const t=e.substring(0,68);for(let e=0;e<t.length;e++){const o=t[e];"0123456789".indexOf(o)>-1?a+=parseInt(o):"-"==o&&a++}return a%10}const c={mu:398600.8,radiusEarthKm:6378.135,xke:.07436691613317342,tumin:13.44683969695931,j2:.001082616,j3:-253881e-11,j4:-165597e-11};function i(e){return 2*Math.PI*e/360}function l(e,a){const t=[];let o=1;t.push(o);for(let n=1;n<=a;n++)o*=e,t.push(o);return t}function s(e,a,t,o){const n=i(e.meanAnomaly),r=i(e.argPerigee),c=i(e.raAscNode);return{a:a.semiMajorAxisBrouwer,incl:i(e.inclination),ecc:e.eccentricity,M:n+t.MDot*o,omega:r+t.omegaDot*o,Omega:c+t.OmegaDot*o}}function M(e,a,t){const o=-c.j3,n=.5*c.j2,r=Math.sqrt(1-a.ecc**2);let l=i(e.inclination);void 0!==t&&(l=t);const s=Math.cos(l),M=o*Math.sin(a.incl)/(4*n*a.a*r*r),m=a.ecc*Math.cos(a.omega),d=a.M+a.omega+a.Omega+.5*M*m*(3+5*s)/(1+s),h=a.ecc*Math.sin(a.omega)+M,u=function(e){const a=2*Math.PI;return e-a*Math.floor(e/a)}(d-a.Omega);let f=u,g=1e-12+1,E=0;for(;E<=10&&Math.abs(g)>1e-12;)g=-(u-h*Math.cos(f)+m*Math.sin(f)-f)/(h*Math.sin(f)+m*Math.cos(f)-1),Math.abs(g)>=.95&&(g=.95*Math.sign(g)),f+=g,E++;const p=m*Math.cos(f)+h*Math.sin(f),D=m*Math.sin(f)-h*Math.cos(f),I=Math.atan2(D,p),b=Math.sqrt(m*m+h*h),N=a.a*(1-b*b),y=a.a*(1-b*Math.cos(I)),C=a.a/y*(Math.cos(f)-m+h*D/(1+Math.sqrt(1-b**2))),_=a.a/y*(Math.sin(f)-h-m*D/(1+Math.sqrt(1-b**2))),O=Math.atan2(_,C),L=Math.sqrt(a.a)*D/y,T=Math.sqrt(N)/y,w=Math.pow(a.a,-1.5),P=Math.sin(2*O),A=Math.cos(2*O),R=s**2,F=.5*n*(1-R)*A/N,S=-.25*n*(7*R-1)*P/(N*N),B=1.5*n*s*P/(N*N),U=1.5*n*s*Math.sin(a.incl)*A/(N*N),k=-n*w*(1-R)*P/N,j=n*w*((1-R)*A-1.5*(1-3*R))/N;return{r:y*(1-1.5*n*Math.sqrt(1-b**2)*(3*R-1)/N**2)+F,u:O+S,Omega:a.Omega+B,incl:a.incl+U,rdot:L+k,rfdot:T+j}}function m(e){const a=-Math.sin(e.Omega)*Math.cos(e.incl),t=Math.cos(e.Omega)*Math.cos(e.incl),o=Math.sin(e.incl),n=Math.cos(e.Omega),r=Math.sin(e.Omega),i=a*Math.sin(e.u)+n*Math.cos(e.u),l=t*Math.sin(e.u)+r*Math.cos(e.u),s=o*Math.sin(e.u)+0*Math.cos(e.u),M=a*Math.cos(e.u)-n*Math.sin(e.u),m=t*Math.cos(e.u)-r*Math.sin(e.u),d=o*Math.cos(e.u)-0*Math.sin(e.u),h=c.radiusEarthKm*c.xke/60;return{r:[e.r*i*c.radiusEarthKm,e.r*l*c.radiusEarthKm,e.r*s*c.radiusEarthKm],v:[(e.rdot*i+e.rfdot*M)*h,(e.rdot*l+e.rfdot*m)*h,(e.rdot*s+e.rfdot*d)*h]}}function d(e,a,t,o,n,r){const c=o+2*n*Math.sin(o),i=.5*Math.sin(c)*Math.sin(c)-.25,l=-.5*Math.sin(c)*Math.cos(c),s=Math.sqrt(1-e*e);return{deltaecc:-30*s*r*e/a*(i*(t.X2*t.X3+t.X1*t.X4)+l*(t.X2*t.X4-t.X1*t.X3)),deltaI:-r/(a*s)*(i*t.Z12+l*(t.Z13-t.Z11)),deltaM:-2*r/a*(i*t.Z2+l*(t.Z3-t.Z1)-3*n*Math.sin(c)*(7+3*e*e)),deltaomegaI:2*s*r/a*(i*t.Z32+l*(t.Z33-t.Z31)-9*n*Math.sin(c)),deltaOmegaI:r/(a*s)*(i*t.Z22+l*(t.Z23-t.Z21))}}const h={NO_RESONANCE:1,ONE_DAY_RESONANCE:2,HALF_DAY_RESONANCE:3};const u={SGP4:1,SDP4:2};function f(e,a){if(e.solverType==u.SGP4){const t=s(e.tle,e.brouwer,e.secGrav,a),o=function(e,a,t,o,n){const{C1:r,C2:s,C3:M,C4:m,C5:d,D2:h,D3:u,D4:f,qs4Term:g,s:E,t2cof:p,t3cof:D,t4cof:I,t5cof:b,xi:N,eta:y,beta0:C,theta:_,useSimplifiedDrag:O}=o,L=(i(e.meanAnomaly),i(e.argPerigee)),T=i(e.meanAnomaly),w=e.eccentricity,P=l(a.semiMajorAxisBrouwer,2),A=a.meanMotionBrouwer,R=l(n,5),F=(i(e.inclination),.5*c.j2),S=e.dragTerm;let B,U,k,j,x,v;if(O){B=t.M,U=t.omega,k=t.Omega-A*F*_[1]*10.5/(P[2]*C[2])*r[1]*R[2],j=e.eccentricity-S*m*R[1],j<1e-6&&(j=1e-6);const o=a.meanMotionBrouwer;x=Math.pow(c.xke/o,2/3)*Math.pow(1-r[1]*R[1],2),v=B+U+k+A*(p*R[2])}else{const o=e.dragTerm*M*Math.cos(L)*n;let i=-2/3*g*e.dragTerm*N[4]/(y[1]*w)*(Math.pow(1+y[1]*Math.cos(t.M),3)-Math.pow(1+y[1]*Math.cos(T),3));e.eccentricity<=1e-4&&(i=0),B=t.M+o+i,U=t.omega-o-i,k=t.Omega-A*F*_[1]*10.5/(P[2]*C[2])*r[1]*R[2],j=e.eccentricity-S*m*R[1]-S*d*(Math.sin(B)-Math.sin(T)),j<1e-6&&(j=1e-6);const l=a.meanMotionBrouwer;x=Math.pow(c.xke/l,2/3)*Math.pow(1-r[1]*R[1]-h*R[2]-u*R[3]-f*R[4],2),v=B+U+k+A*(p*R[2]+D*R[3]+I*R[4]+b*R[5])}return v%=2*Math.PI,B=(v-U-k)%(2*Math.PI),{a:x,incl:t.incl,ecc:j,M:B,omega:U,Omega:k,L:v}}(e.tle,e.brouwer,t,e.dragTerms,a);return m(M(e.tle,o))}{const t=function(e,a,t){return{a:e.a,incl:e.incl+t*a.dIdt,ecc:e.ecc+t*a.dedt,M:e.M+t*a.dMdt,omega:e.omega+t*a.domegadt,Omega:e.Omega+t*a.dOmegadt}}(s(e.tle,e.brouwer,e.secGrav,a),e.thirdBodyCommon.secularRates,a);let o;o=e.resonance.type==h.NO_RESONANCE?{M:t.M,n:c.xke/Math.pow(t.a,1.5)}:function(e,a,t,o,n,r){let c=720,l=c*c;n-r.minsAfterEpoch<0&&(c=-c);const s=5.7686396,M=.95240898,m=1.8014998,d=1.050833,u=4.4108898,f=.13130908,g=2.8843198,E=.37448087,p=(function(e){const a=(e-2451545)/36525,t=2*Math.PI;let o=-62e-7*a*a*a+.093104*a*a+3164400184.812866*a+67310.54841;return o=o*Math.PI/43200%t,o<0&&(o+=t),o}(e.jtUt1Epoch)+.0043752690880113*n)%(2*Math.PI);for(;;){if(a.type==h.ONE_DAY_RESONANCE){const e=a.coeffs;r.dndt=e.delta1*Math.sin(r.lambda-f)+e.delta2*Math.sin(2*(r.lambda-g))+e.delta3*Math.sin(3*(r.lambda-E)),r.dlambdadt=r.n+r.dlambdadt0,r.dnddt=e.delta1*Math.cos(r.lambda-f)+2*e.delta2*Math.cos(2*(r.lambda-g))+3*e.delta3*Math.cos(3*(r.lambda-E)),r.dnddt*=r.dlambdadt}else if(a.type==h.HALF_DAY_RESONANCE){const o=i(e.argPerigee)+t.omegaDot*r.minsAfterEpoch,n=a.coeffs;r.dndt=n.D2201*Math.sin(2*o+r.lambda-s)+n.D2211*Math.sin(r.lambda-s)+n.D3210*Math.sin(o+r.lambda-M)+n.D3222*Math.sin(-o+r.lambda-M)+n.D4410*Math.sin(2*o+2*r.lambda-m)+n.D4422*Math.sin(2*r.lambda-m)+n.D5220*Math.sin(o+r.lambda-d)+n.D5232*Math.sin(-o+r.lambda-d)+n.D5421*Math.sin(o+2*r.lambda-u)+n.D5433*Math.sin(-o+2*r.lambda-u),r.dlambdadt=r.n+r.dlambdadt0,r.dnddt=n.D2201*Math.cos(2*o+r.lambda-s)+n.D2211*Math.cos(r.lambda-s)+n.D3210*Math.cos(o+r.lambda-M)+n.D3222*Math.cos(-o+r.lambda-M)+n.D5220*Math.cos(o+r.lambda-d)+n.D5232*Math.cos(-o+r.lambda-d)+2*(n.D4410*Math.cos(2*o+2*r.lambda-m)+n.D4422*Math.cos(2*r.lambda-m)+n.D5421*Math.cos(o+2*r.lambda-u)+n.D5433*Math.cos(-o+2*r.lambda-u)),r.dnddt*=r.dlambdadt}if(Math.abs(r.minsAfterEpoch-n)<Math.abs(c))break;r.lambda+=r.dlambdadt*c+.5*r.dndt*l,r.n+=r.dndt*c+.5*r.dnddt*l,r.minsAfterEpoch+=c}const D=n-r.minsAfterEpoch,I=r.lambda+r.dlambdadt*D+.5*r.dndt*D**2,b=r.n+r.dndt*D+.5*r.dnddt*D**2;let N;return a.type==h.HALF_DAY_RESONANCE?N=(I-2*o.Omega+2*p)%(2*Math.PI):a.type==h.ONE_DAY_RESONANCE&&(N=(I-o.Omega-o.omega+p)%(2*Math.PI)),{M:N,n:b}}(e.tle,e.resonance,e.secGrav,t,a,e.integrationState);const n=Math.pow(c.xke/o.n,2/3)*Math.pow(1-e.dragTerms.C1[1]*a,2),r=c.xke/Math.pow(n,1.5),l=t.ecc-e.tle.dragTerm*e.dragTerms.C4*a;let u=(o.M+e.brouwer.meanMotionBrouwer*e.dragTerms.t2cof*a*a)%(2*Math.PI);const f={a:n,incl:t.incl,ecc:l,M:u,omega:t.omega,Omega:t.Omega,n:r},g=function(e,a,t,o,n,r){const c=e.jtUt1Epoch-2415020,i=4.7199672+.2299715*c-(5.8351514+.001944368*c),l=(6.2565837+.017201977*c+119459e-10*r)%(2*Math.PI),s=(i+.00015835218*r)%(2*Math.PI),M=e.eccentricity,m=a.meanMotionBrouwer,h=d(M,m,t,l,.01675,298647972e-14),u=d(M,m,o,s,.0549,4.796806521e-7),f=h.deltaecc+u.deltaecc,g=h.deltaI+u.deltaI,E=h.deltaM+u.deltaM,p=h.deltaomegaI+u.deltaomegaI,D=h.deltaOmegaI+u.deltaOmegaI,I=n.ecc+f,b=n.incl+g;let N,y,C;if(b>=.2){const e=D/Math.sin(b),a=p-Math.cos(b)*e;N=n.omega+a,y=n.Omega+e,C=n.M+E}else{const e=Math.sin(b)*Math.sin(n.Omega)+D*Math.cos(n.Omega)+g*Math.cos(b)*Math.sin(n.Omega),a=Math.sin(b)*Math.cos(n.Omega)-D*Math.sin(n.Omega)+g*Math.cos(b)*Math.cos(n.Omega);y=n.Omega%(2*Math.PI),y<0&&(y+=2*Math.PI);const t=(n.M+n.omega+Math.cos(b)*y+E+p-g*Math.sin(b)*y)%(2*Math.PI),o=y;y=Math.atan2(e,a),y<0&&(y+=2*Math.PI),Math.abs(y-o)>Math.PI&&(y<o?y+=2*Math.PI:y-=2*Math.PI),C=n.M+E,N=t-C-Math.cos(b)*y}return{a:n.a,n:n.n,ecc:I,incl:b,Omega:y,omega:N,M:C}}(e.tle,e.brouwer,e.thirdBodyCommon.sun,e.thirdBodyCommon.moon,f,a);return g.incl<0&&(g.incl*=-1,g.Omega+=Math.PI,g.omega-=Math.PI),m(M(e.tle,g,g.incl))}}return a})()));