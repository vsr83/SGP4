!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.sgp4=e():t.sgp4=e()}(self,(()=>(()=>{"use strict";var t={d:(e,a)=>{for(var o in a)t.o(a,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{coordTemeJ2000:()=>T,coordTemePef:()=>D,coordTemeTod:()=>I,createTarget:()=>A,nutationTerms:()=>g,propagateTarget:()=>P,propagateTargetJulian:()=>B,propagateTargetTs:()=>L,tleFromLines:()=>n});const a={FIELD_NUMBER:1,FIELD_NUMBER_IMPLIED:2,FIELD_NUMBER_MAPPED:3,FIELD_STRING:4},o=[{name:"title",fieldType:a.FIELD_STRING,row:0,startCol:0,endCol:23},{name:"catalogNumber",fieldType:a.FIELD_NUMBER,row:1,startCol:2,endCol:6},{name:"classification",fieldType:a.FIELD_STRING,row:1,startCol:7,endCol:7},{name:"intLaunchYear",fieldType:a.FIELD_STRING,row:1,startCol:9,endCol:10},{name:"intLaunchNum",fieldType:a.FIELD_STRING,row:1,startCol:11,endCol:13},{name:"intLaunchPiece",fieldType:a.FIELD_STRING,row:1,startCol:14,endCol:16},{name:"epochYear",fieldType:a.FIELD_NUMBER_MAPPED,row:1,startCol:18,endCol:19,callback:function(t){return t>56?1900+t:2e3+t}},{name:"epochFracDay",fieldType:a.FIELD_NUMBER,row:1,startCol:20,endCol:31},{name:"meanMotionDer",fieldType:a.FIELD_NUMBER,row:1,startCol:33,endCol:42},{name:"meanMotionDer2",fieldType:a.FIELD_NUMBER_IMPLIED,row:1,startCol:44,endCol:51},{name:"dragTerm",fieldType:a.FIELD_NUMBER_IMPLIED,row:1,startCol:53,endCol:60},{name:"ephemerisType",fieldType:a.FIELD_NUMBER,row:1,startCol:62,endCol:62},{name:"elementSetNo",fieldType:a.FIELD_NUMBER,row:1,startCol:64,endCol:67},{name:"checkSum1",fieldType:a.FIELD_NUMBER,row:1,startCol:68,endCol:68},{name:"catalogNumber2",fieldType:a.FIELD_NUMBER,row:2,startCol:2,endCol:6},{name:"inclination",fieldType:a.FIELD_NUMBER,row:2,startCol:8,endCol:15},{name:"raAscNode",fieldType:a.FIELD_NUMBER,row:2,startCol:17,endCol:24},{name:"eccentricity",fieldType:a.FIELD_NUMBER_IMPLIED,row:2,startCol:26,endCol:32},{name:"argPerigee",fieldType:a.FIELD_NUMBER,row:2,startCol:34,endCol:41},{name:"meanAnomaly",fieldType:a.FIELD_NUMBER,row:2,startCol:43,endCol:50},{name:"meanMotion",fieldType:a.FIELD_NUMBER,row:2,startCol:52,endCol:62},{name:"revNoAtEpoch",fieldType:a.FIELD_NUMBER,row:2,startCol:63,endCol:67},{name:"checkSum2",fieldType:a.FIELD_NUMBER,row:2,startCol:68,endCol:68}];function n(t){const e={},n={};for(let e=0;e<o.length;e++){const r=o[e],c=t[r.row].substring(r.startCol,r.endCol+1);switch(r.fieldType){case a.FIELD_STRING:n[r.name]=c;break;case a.FIELD_NUMBER:n[r.name]=Number(c);break;case a.FIELD_NUMBER_IMPLIED:"-"==c[0]?n[r.name]=-Number("0."+c.substring(1).replace("-","e-").replace("+","e").replace(" ","")):n[r.name]=Number("0."+c.replace("-","e-").replace("+","e").replace(" ",""));break;case a.FIELD_NUMBER_MAPPED:r.callback&&(n[r.name]=r.callback(Number(c)))}}return function(t){e.title=t.title,e.catalogNumber=t.catalogNumber,e.classification=t.classification,e.intLaunchYear=t.intLaunchYear,e.intLaunchNum=t.intLaunchNum,e.intLaunchPiece=t.intLaunchPiece,e.epochYear=t.epochYear,e.epochFracDay=t.epochFracDay,e.meanMotionDer=t.meanMotionDer,e.meanMotionDer2=t.meanMotionDer2,e.dragTerm=t.dragTerm,e.ephemerisType=t.ephemerisType,e.elementSetNo=t.elementSetNo,e.checkSum1=t.checkSum1,e.catalogNumber2=t.catalogNumber2,e.inclination=t.inclination,e.raAscNode=t.raAscNode,e.eccentricity=t.eccentricity,e.argPerigee=t.argPerigee,e.meanAnomaly=t.meanAnomaly,e.meanMotion=t.meanMotion,e.revNoAtEpoch=t.revNoAtEpoch,e.checkSum2=t.checkSum2}(n),e.checkSumValid=r(t[1])==e.checkSum1&&r(t[2])==e.checkSum2,e.jtUt1Epoch=function(t,e){const a=[31,t%4==0?29:28,31,30,31,30,31,31,30,31,30,31],o=Math.floor(e);let n=0,r=0;for(n=0;n<12;n++){const t=a[n];if(o-r-t<0)break;r+=t}const i=o-r,s=e-o,M=Math.floor(24*s),h=Math.floor(1440*(s-M/24));return c(t,n+1,i,M,h,86400*(s-M/24-h/1440))}(e.epochYear,e.epochFracDay),e}function r(t){let e=0;const a=t.substring(0,68);for(let t=0;t<a.length;t++){const o=a[t];"0123456789".indexOf(o)>-1?e+=parseInt(o):"-"==o&&e++}return e%10}function c(t,e,a,o,n,r){const c=function(t,e,a){e<3&&(t--,e+=12);const o=Math.floor(t/100),n=Math.floor(o/4);return Math.floor(2-o+n)+a+Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))-1524.5}(t,e,a);return c+o/24+n/1440+r/86400}const i={mu:398600.8,radiusEarthKm:6378.135,xke:.07436691613317342,tumin:13.44683969695931,j2:.001082616,j3:-253881e-11,j4:-165597e-11},s={ERROR_NONE:0,ERROR_MEAN_ECCENTRICITY:1,ERROR_MEAN_MOTION:2,ERROR_PERT_ECCENTRICITY:3,ERROR_SEMI_LATUS_RECTUM:4,ERROR_EPOCH_SUBORBITAL:5,ERROR_SATELLITE_DECAYED:6,ERROR_INVALID_TSINCE:7};function M(t){const e=(t-2451545)/36525,a=2*Math.PI;let o=-62e-7*e*e*e+.093104*e*e+3164400184.812866*e+67310.54841;return o=o*Math.PI/43200%a,o<0&&(o+=a),o}function h(t){return 2*Math.PI*t/360}function l(t,e){const a=[];let o=1;a.push(o);for(let n=1;n<=e;n++)o*=t,a.push(o);return a}function m(t){return Math.sin(t*Math.PI/180)}function d(t){return Math.cos(t*Math.PI/180)}function u(t,e,a,o){const n=h(t.meanAnomaly),r=h(t.argPerigee),c=h(t.raAscNode);return{a:e.semiMajorAxisBrouwer,incl:h(t.inclination),ecc:t.eccentricity,M:n+a.MDot*o,omega:r+a.omegaDot*o,Omega:c+a.OmegaDot*o}}function E(t,e,a){const o=-i.j3,n=.5*i.j2,r=Math.sqrt(1-e.ecc**2);let c=h(t.inclination);void 0!==a&&(c=a);const M=Math.cos(c),l=o*Math.sin(e.incl)/(4*n*e.a*r*r),m=e.ecc*Math.cos(e.omega),d=e.M+e.omega+e.Omega+.5*l*m*(3+5*M)/(1+M),u=e.ecc*Math.sin(e.omega)+l,E=function(t){const e=2*Math.PI;return t-e*Math.floor(t/e)}(d-e.Omega);let f=E,g=1e-12+1,p=0;for(;p<=10&&Math.abs(g)>1e-12;)g=-(E-u*Math.cos(f)+m*Math.sin(f)-f)/(u*Math.sin(f)+m*Math.cos(f)-1),Math.abs(g)>=.95&&(g=.95*Math.sign(g)),f+=g,p++;const D=m*Math.cos(f)+u*Math.sin(f),I=m*Math.sin(f)-u*Math.cos(f),T=Math.atan2(I,D),C=Math.sqrt(m*m+u*u),N=e.a*(1-C*C);if(N<0)throw{type:s.ERROR_SEMI_LATUS_RECTUM,message:"Semi-latus rectum "+N+" negative!"};const R=e.a*(1-C*Math.cos(T)),y=e.a/R*(Math.cos(f)-m+u*I/(1+Math.sqrt(1-C**2))),O=e.a/R*(Math.sin(f)-u-m*I/(1+Math.sqrt(1-C**2))),b=Math.atan2(O,y),_=Math.sqrt(e.a)*I/R,w=Math.sqrt(N)/R,A=Math.pow(e.a,-1.5),P=Math.sin(2*b),B=Math.cos(2*b),L=M**2,S=.5*n*(1-L)*B/N,v=-.25*n*(7*L-1)*P/(N*N),Z=1.5*n*M*P/(N*N),U=1.5*n*M*Math.sin(e.incl)*B/(N*N),F=-n*A*(1-L)*P/N,j=n*A*((1-L)*B-1.5*(1-3*L))/N,k=R*(1-1.5*n*Math.sqrt(1-C**2)*(3*L-1)/N**2)+S,Y=b+v,x=e.Omega+Z,X=e.incl+U,q=_+F,G=w+j;if(k<1)throw{type:s.ERROR_SATELLITE_DECAYED,message:"Satellite orbit decayed!"};return{r:k,u:Y,Omega:x,incl:X,rdot:q,rfdot:G}}const f=[[0,0,0,0,1,-6798.4,-171996,-174.2,92025,8.9],[0,0,2,-2,2,182.6,-13187,-1.6,5736,-3.1],[0,0,2,0,2,13.7,-2274,-.2,977,-.5],[0,0,0,0,2,-3399.2,2062,.2,-895,.5],[0,-1,0,0,0,-365.3,-1426,3.4,54,-.1],[1,0,0,0,0,27.6,712,.1,-7,0],[0,1,2,-2,2,121.7,-517,1.2,224,-.6],[0,0,2,0,1,13.6,-386,-.4,200,0],[1,0,2,0,2,9.1,-301,0,129,-.1],[0,-1,2,-2,2,365.2,217,-.5,-95,.3],[-1,0,0,2,0,31.8,158,0,-1,0],[0,0,2,-2,1,177.8,129,.1,-70,0],[-1,0,2,0,2,27.1,123,0,-53,0],[1,0,0,0,1,27.7,63,.1,-33,0],[0,0,0,2,0,14.8,63,0,-2,0],[-1,0,2,2,2,9.6,-59,0,26,0],[-1,0,0,0,1,-27.4,-58,-.1,32,0],[1,0,2,0,1,9.1,-51,0,27,0],[-2,0,0,2,0,-205.9,-48,0,1,0],[-2,0,2,0,1,1305.5,46,0,-24,0],[0,0,2,2,2,7.1,-38,0,16,0],[2,0,2,0,2,6.9,-31,0,13,0],[2,0,0,0,0,13.8,29,0,-1,0],[1,0,2,-2,2,23.9,29,0,-12,0],[0,0,2,0,0,13.6,26,0,-1,0],[0,0,2,-2,0,173.3,-22,0,0,0],[-1,0,2,0,1,27,21,0,-10,0],[0,2,0,0,0,182.6,17,-.1,0,0],[0,2,2,-2,2,91.3,-16,.1,7,0],[-1,0,0,2,1,32,16,0,-8,0],[0,1,0,0,1,386,-15,0,9,0],[1,0,0,-2,1,-31.7,-13,0,7,0],[0,-1,0,0,1,-346.6,-12,0,6,0],[2,0,-2,0,0,-1095.2,11,0,0,0],[-1,0,2,2,1,9.5,-10,0,5,0],[1,0,2,2,2,5.6,-8,0,3,0],[0,-1,2,0,2,14.2,-7,0,3,0],[0,0,2,2,1,7.1,-7,0,3,0],[1,1,0,-2,0,-34.8,-7,0,0,0],[0,1,2,0,2,13.2,7,0,-3,0],[-2,0,0,2,1,-199.8,-6,0,3,0],[0,0,0,2,1,14.8,-6,0,3,0],[2,0,2,-2,2,12.8,6,0,-3,0],[1,0,0,2,0,9.6,6,0,0,0],[1,0,2,-2,1,23.9,6,0,-3,0],[0,0,0,-2,1,-14.7,-5,0,3,0],[0,-1,2,-2,1,346.6,-5,0,3,0],[2,0,2,0,1,6.9,-5,0,3,0],[1,-1,0,0,0,29.8,5,0,0,0],[1,0,0,-1,0,411.8,-4,0,0,0],[0,0,0,1,0,29.5,-4,0,0,0],[0,1,0,-2,0,-15.4,-4,0,0,0],[1,0,-2,0,0,-26.9,4,0,0,0],[2,0,0,-2,1,212.3,4,0,-2,0],[0,1,2,-2,1,119.6,4,0,-2,0],[1,1,0,0,0,25.6,-3,0,0,0],[1,-1,0,-1,0,-3232.9,-3,0,0,0],[-1,-1,2,2,2,9.8,-3,0,1,0],[0,-1,2,2,2,7.2,-3,0,1,0],[1,-1,2,0,2,9.4,-3,0,1,0],[3,0,2,0,2,5.5,-3,0,1,0],[-2,0,2,0,2,1615.7,-3,0,1,0],[1,0,2,0,0,9.1,3,0,0,0],[-1,0,2,4,2,5.8,-2,0,1,0],[1,0,0,0,2,27.8,-2,0,1,0],[-1,0,2,-2,1,-32.6,-2,0,1,0],[0,-2,2,-2,1,6786.3,-2,0,1,0],[-2,0,0,0,1,-13.7,-2,0,1,0],[2,0,0,0,1,13.8,2,0,-1,0],[3,0,0,0,0,9.2,2,0,0,0],[1,1,2,0,2,8.9,2,0,-1,0],[0,0,2,1,2,9.3,2,0,-1,0],[1,0,0,2,1,9.6,-1,0,0,0],[1,0,2,2,1,5.6,-1,0,1,0],[1,1,0,-2,1,-34.7,-1,0,0,0],[0,1,0,2,0,14.2,-1,0,0,0],[0,1,2,-2,0,117.5,-1,0,0,0],[0,1,-2,2,0,-329.8,-1,0,0,0],[1,0,-2,2,0,23.8,-1,0,0,0],[1,0,-2,-2,0,-9.5,-1,0,0,0],[1,0,2,-2,0,32.8,-1,0,0,0],[1,0,0,-4,0,-10.1,-1,0,0,0],[2,0,0,-4,0,-15.9,-1,0,0,0],[0,0,2,4,2,4.8,-1,0,0,0],[0,0,2,-1,2,25.4,-1,0,0,0],[-2,0,2,4,2,7.3,-1,0,1,0],[2,0,2,2,2,4.7,-1,0,0,0],[0,-1,2,0,1,14.2,-1,0,0,0],[0,0,-2,0,1,-13.6,-1,0,0,0],[0,0,4,-2,2,12.7,1,0,0,0],[0,1,0,0,2,409.2,1,0,0,0],[1,1,2,-2,2,22.5,1,0,-1,0],[3,0,2,-2,2,8.7,1,0,0,0],[-2,0,2,2,2,14.6,1,0,-1,0],[-1,0,0,0,2,-27.3,1,0,-1,0],[0,0,-2,2,1,-169,1,0,0,0],[0,1,2,0,1,13.1,1,0,0,0],[-1,0,4,0,2,9.1,1,0,0,0],[2,1,0,-2,0,131.7,1,0,0,0],[2,0,0,2,0,7.1,1,0,0,0],[2,0,2,-2,1,12.8,1,0,-1,0],[2,0,-2,0,1,-943.2,1,0,0,0],[1,-1,0,-2,0,-29.3,1,0,0,0],[-1,0,0,1,1,-388.3,1,0,0,0],[-1,-1,0,2,1,35,1,0,0,0],[0,1,0,1,0,27.3,1,0,0,0]];function g(t){const e=t*t,a=e*t,o=23.4392911111-.0130041667*t-1.6388888889e-7*e+5.0361111111e-7*a,n=134.9629813889+198.8673980555*t+.0086972222222*e+17777777778e-15*a+477e3*t%360,r=357.5277233333+359.05034*t-.00016027777778*e-33333333333e-16*a+35640*t%360,c=93.2719102778+82.0175380556*t-.0036825*e+30555555555e-16*a+483120*t%360,i=297.8503630555+307.11148*t-.0019141666667*e+52777777778e-16*a+444960*t%360,s=125.0445222222-134.1362608333*t+.0020708333333*e+22222222222e-16*a-1800*t%360,M=1/36e6,h=f.length;let l=0,m=0;for(let e=0;e<h;e++){const a=f[e],o=a[0]*n+a[1]*r+a[2]*c+a[3]*i+a[4]*s;l+=M*(a[6]+a[7]*t)*Math.sin(o*Math.PI/180),m+=M*(a[8]+a[9]*t)*Math.cos(o*Math.PI/180)}return{eps:o,deps:m%360,dpsi:l%360}}function p(t){const e=-Math.sin(t.Omega)*Math.cos(t.incl),a=Math.cos(t.Omega)*Math.cos(t.incl),o=Math.sin(t.incl),n=Math.cos(t.Omega),r=Math.sin(t.Omega),c=e*Math.sin(t.u)+n*Math.cos(t.u),s=a*Math.sin(t.u)+r*Math.cos(t.u),M=o*Math.sin(t.u)+0*Math.cos(t.u),h=e*Math.cos(t.u)-n*Math.sin(t.u),l=a*Math.cos(t.u)-r*Math.sin(t.u),m=o*Math.cos(t.u)-0*Math.sin(t.u),d=i.radiusEarthKm*i.xke/60;return{r:[t.r*c*i.radiusEarthKm,t.r*s*i.radiusEarthKm,t.r*M*i.radiusEarthKm],v:[(t.rdot*c+t.rfdot*h)*d,(t.rdot*s+t.rfdot*l)*d,(t.rdot*M+t.rfdot*m)*d]}}function D(t){const e=M(t.JT),a=C(t.r,e),o=C(t.v,e),n=t.JT-2451544.5,r=1/86400*(360.985647366+581576e-18*n+-159048e-26*n*n);return o[0]+=r*(Math.PI/180)*(-Math.sin(e)*t.r[0]+Math.cos(e)*t.r[1]),o[1]+=r*(Math.PI/180)*(-Math.cos(e)*t.r[0]-Math.sin(e)*t.r[1]),{r:a,v:o,JT:t.JT}}function I(t,e){void 0===e&&(e=g((t.JT-2451545)/36525));const a=Math.PI/180*(e.dpsi*Math.cos(Math.PI/180*e.eps));return{r:C(t.r,-a),v:C(t.v,-a),JT:t.JT}}function T(t,e){I(t,e),function(t,e){const a=(t.JT-2451545)/36525;void 0===e&&(e=g(a));N(y(N(t.r,e.eps+e.deps),e.dpsi),-e.eps),N(y(N(t.v,e.eps+e.deps),e.dpsi),-e.eps);t.JT}(t,e);const a=function(t){const e=(t.JT-2451545)/36525,a=e*e,o=a*e,n=.6406161388*e+.00030407777777*a+50563888888e-16*o,r=.5567530277*e-.00011851388888*a-11620277777e-15*o,c=.6406161388*e+83855555555e-15*a+49994444444e-16*o;return{r:y(R(y(t.r,n),-r),c),v:y(R(y(t.v,n),-r),c),JT:t.JT}}(t);return a}function C(t,e){return[Math.cos(e)*t[0]+Math.sin(e)*t[1],-Math.sin(e)*t[0]+Math.cos(e)*t[1],t[2]]}function N(t,e){return[t[0],d(e)*t[1]+m(e)*t[2],-m(e)*t[1]+d(e)*t[2]]}function R(t,e){return[d(e)*t[0]-m(e)*t[2],t[1],m(e)*t[0]+d(e)*t[2]]}function y(t,e){return[d(e)*t[0]+m(e)*t[1],-m(e)*t[0]+d(e)*t[1],t[2]]}function O(t,e,a,o,n,r,c){const i=Math.cos(n),s=Math.sin(n),M=Math.cos(r),h=Math.sin(r),l=Math.cos(e),m=Math.sin(e),d=Math.cos(a),u=Math.sin(a),E=Math.cos(o-c),f=Math.sin(o-c),g=M*E+h*i*f,p=-h*E+M*i*f,D=-M*f+h*i*E,I=h*s,T=h*f+M*i*E,C=M*s,N=D*l+I*m,R=T*l+C*m,y=-D*m+I*l,O=-T*m+C*l,b=g*d+N*u,_=p*d+R*u,w=-g*u+N*d,A=-p*u+R*d,P=y*u,B=O*u,L=y*d,S=O*d,v=t*t,Z=12*b*b-3*w*w,U=24*b*_-6*w*A,F=12*_*_-3*A*A;return{a1:g,a2:N,a3:p,a4:R,a5:y,a6:O,a7:D,a8:I,a9:T,a10:C,X1:b,X2:_,X3:w,X4:A,X5:P,X6:B,X7:L,X8:S,Z1:6*(g*g+N*N)+(1+v)*Z,Z2:12*(g*p+N*R)+(1+v)*U,Z3:6*(p*p+R*R)+(1+v)*F,Z11:-6*g*y+v*(-24*b*L-6*w*P),Z12:-6*g*O-6*p*y-v*(24*_*L+24*b*S+6*w*B+6*A*P),Z13:-6*p*O+v*(-24*_*S-6*A*B),Z21:6*N*y+v*(24*b*P-6*w*L),Z22:6*R*y+6*N*O+v*(24*_*P+24*b*B-6*A*L-6*w*S),Z23:6*R*O+v*(24*_*B-6*A*S),Z31:Z,Z32:U,Z33:F}}function b(t,e,a,o,n,r){const c=o+2*n*Math.sin(o),i=.5*Math.sin(c)*Math.sin(c)-.25,s=-.5*Math.sin(c)*Math.cos(c),M=Math.sqrt(1-t*t);return{deltaecc:-30*M*r*t/e*(i*(a.X2*a.X3+a.X1*a.X4)+s*(a.X2*a.X4-a.X1*a.X3)),deltaI:-r/(e*M)*(i*a.Z12+s*(a.Z13-a.Z11)),deltaM:-2*r/e*(i*a.Z2+s*(a.Z3-a.Z1)-3*n*Math.sin(c)*(7+3*t*t)),deltaomegaI:2*M*r/e*(i*a.Z32+s*(a.Z33-a.Z31)-9*n*Math.sin(c)),deltaOmegaI:r/(e*M)*(i*a.Z22+s*(a.Z23-a.Z21))}}const _={NO_RESONANCE:1,ONE_DAY_RESONANCE:2,HALF_DAY_RESONANCE:3};const w={SGP4:1,SDP4:2};function A(t){const e={};var a;return e.tle=t,e.brouwer=function(t){const e=h(t.inclination),a=1440/(2*Math.PI),o=1-t.eccentricity*t.eccentricity,n=Math.cos(e),r=t.meanMotion/a,c=Math.pow(i.xke/r,2/3),s=.75*i.j2*(3*n*n-1)/(Math.sqrt(o)*o);let M=s/(c*c);const l=c*(1-M*(1/3+M*(1+134/81*M)));M=s/(l*l);const m=r/(1+M);return{meanMotionBrouwer:m,semiMajorAxisBrouwer:Math.pow(i.xke/m,2/3)}}(t),e.secGrav=function(t,e){const a=h(t.inclination),o=l(Math.cos(a),4),n=l(e.semiMajorAxisBrouwer*i.radiusEarthKm,4),r=l(Math.sqrt(1-t.eccentricity*t.eccentricity),8),c=l(i.radiusEarthKm,4),s=.5*c[2]*i.j2,M=-.375*c[4]*i.j4;let m=1+1.5*s*(3*o[2]-1)/(n[2]*r[3])+.1875*s*s*(13-78*o[2]+137*o[4])/(n[4]*r[7]),d=1.5*s*(5*o[2]-1)/(n[2]*r[4])+.1875*s*s*(7-114*o[2]+395*o[4])/(n[4]*r[8])+1.25*M*(3-36*o[2]+49*o[4])/(n[4]*r[8]),u=-3*s*o[1]/(n[2]*r[4])+1.5*s*s*(4*o[1]-19*o[3])/(n[4]*r[8])+2.5*M*(3*o[1]-7*o[3])/(n[4]*r[8]);return m*=e.meanMotionBrouwer,d*=e.meanMotionBrouwer,u*=e.meanMotionBrouwer,{MDot:m,omegaDot:d,OmegaDot:u}}(t,e.brouwer),e.dragTerms=function(t,e){const a=e.semiMajorAxisBrouwer*(1-t.eccentricity);let o=!1;a<220/i.radiusEarthKm+1&&(o=!0);const n=(a-1)*i.radiusEarthKm;let r;r=n<98?20:n<156?n-78:78;const c=r/i.radiusEarthKm+1,s=Math.pow((120-r)/i.radiusEarthKm,4),M=t.eccentricity,m=e.semiMajorAxisBrouwer,d=e.meanMotionBrouwer,u=h(t.argPerigee),E=h(t.inclination),f=l(1/(m-c),5),g=l(m*M*f[1],8),p=l(Math.sqrt(1-M*M),2),D=l(Math.cos(E),2),I=-i.j3,T=.5*i.j2;let C=s*f[4]*d*Math.pow(1-g[2],-3.5)*(m*(1+1.5*g[2]+M*(4*g[1]+g[3]))+1.5*T*f[1]/(1-g[2])*(1.5*D[2]-.5)*(8+24*g[2]+3*g[4]));const N=l(t.dragTerm*C,4);let R=0;M>1e-4&&(R=s*f[5]*I*d*Math.sin(E)/(T*M));const y=2*d*s*f[4]*m*p[2]*Math.pow(1-g[2],-3.5)*(2*g[1]*(1+M*g[1])+.5*M+.5*g[3]-2*T*f[1]/(m*(1-g[2]))*(3*(1-3*D[2])*(1+1.5*g[2]-2*M*g[1]-.5*M*g[3])+.75*(1-D[2])*(2*g[2]-M*g[1]-M*g[3])*Math.cos(2*u))),O=2*s*f[4]*m*p[2]*Math.pow(1-g[2],-3.5)*(1+2.75*g[1]*(g[1]+M)+M*g[3]),b=4*m*f[1]*N[2],_=4/3*m*f[2]*(17*m+c)*N[3],w=2/3*m*m*f[3]*(221*m+31*c)*N[4];return{C1:N,C2:C,C3:R,C4:y,C5:O,D2:b,D3:_,D4:w,t2cof:1.5*N[1],t3cof:b+2*N[2],t4cof:.25*(3*_+12*N[1]*b+10*N[3]),t5cof:.2*(3*w+12*N[1]*_+6*b**2+30*N[2]*b+15*N[4]),qs4Term:s,s:c,xi:f,eta:g,beta0:p,theta:D,useSimplifiedDrag:o}}(t,e.brouwer),a=e.brouwer,2*Math.PI/a.meanMotionBrouwer<225?e.solverType=w.SGP4:(e.solverType=w.SDP4,e.thirdBodyCommon=function(t,e){const a=h(281.2208026160437),o=298647972e-14,n=4.796806521e-7,r=119459e-10,c=.00015835218,i=h(23.444100086478358),s=h(t.raAscNode),M=h(t.inclination),l=h(t.argPerigee),m=t.eccentricity,d=e.meanMotionBrouwer,u=Math.sqrt(1-m*m),E=t.jtUt1Epoch-2415020,f=(4.523602-.00092422029*E)%(2*Math.PI),g=5.8351514+.001944368*E,p=h(5.145400276825767),D=Math.cos(i)*Math.cos(p)-Math.sin(i)*Math.sin(p)*Math.cos(f),I=Math.sqrt(1-D**2),T=Math.atan2(I,D),C=Math.sin(p)*Math.sin(f)/Math.sin(T),N=Math.sqrt(1-C**2),R=Math.atan2(C,N),y=Math.sin(i)*Math.sin(f)/Math.sin(T),b=Math.cos(R)*Math.cos(f)+Math.sin(R)*Math.sin(f)*Math.cos(i),_=g-f+Math.atan2(y,b),w=O(m,M,l,s,i,a,0),A=O(m,M,l,s,T,_,R),P=-15*o*r*m/d*u*(w.X1*w.X3+w.X2*w.X4),B=-15*n*c*m/d*u*(A.X1*A.X3+A.X2*A.X4),L=-.5*o*r/u/d*(w.Z11+w.Z13),S=-.5*n*c/u/d*(A.Z11+A.Z13),v=-o*r/d*(w.Z1+w.Z3-14-6*m*m),Z=-n*c/d*(A.Z1+A.Z3-14-6*m*m);let U,F,j,k;return t.inclination<3?(U=0,F=0):(U=o*r/(2*d*u*Math.sin(M))*(w.Z21+w.Z23),F=n*c/(2*d*u*Math.sin(M))*(A.Z21+A.Z23)),t.inclination<3?(j=o*r*u/d*(w.Z31+w.Z33-6),k=n*c*u/d*(A.Z31+A.Z33-6)):(j=o*r*u/d*(w.Z31+w.Z33-6)-U*Math.cos(M),k=n*c*u/d*(A.Z31+A.Z33-6)-F*Math.cos(M)),{sun:w,moon:A,secularRates:{dedt:P+B,dIdt:L+S,dMdt:v+Z,dOmegadt:U+F,domegadt:j+k}}}(t,e.brouwer),e.resonance=function(t,e){let a,o=_.NO_RESONANCE;return e.meanMotionBrouwer>.0034906585&&e.meanMotionBrouwer<.0052359877&&(o=_.ONE_DAY_RESONANCE,a=function(t,e){const a=h(t.inclination),o=Math.cos(a),n=Math.sin(a),r=t.eccentricity,c=e.meanMotionBrouwer,i=e.semiMajorAxisBrouwer;return{delta1:3*c**2/i**3*(.9375*n**2*(1+3*o)-.75*(1+o))*(1+2*r**2)*21460748e-13,delta2:6*c**2/i**2*(.75*Math.pow(1+o,2))*(1-2.5*r**2+.8125*r**4)*17891679e-13,delta3:9*c**2/i**3*(1.875*Math.pow(1+o,3))*(1-6*r**2+6.60937*r**4)*2.2123015e-7}}(t,e)),e.meanMotionBrouwer>=.00826&&e.meanMotionBrouwer<=.00924&&t.eccentricity>=.5&&(o=_.HALF_DAY_RESONANCE,a=function(t,e){const a=t.eccentricity,o=a*a,n=o*a,r=h(t.inclination),c=Math.sin(r),i=c*c,s=Math.cos(r),M=s*s,l=-.306-.44*(a-.64);let m,d,u,E,f,g,p,D,I;a<=.65?(m=3.616-13.247*a+16.29*o,d=117.39*a-19.302-228.419*o+156.591*n,u=109.7927*a-18.9068-214.6334*o+146.5816*n,E=242.694*a-41.122-471.094*o+313.953*n,f=841.88*a-146.407-1629.014*o+1083.435*n,g=3017.977*a-532.114-5740.032*o+3708.276*n):(m=331.819*a-72.099-508.738*o+266.724*n,d=1582.851*a-346.844-2415.925*o+1246.113*n,u=1554.908*a-342.585-2366.899*o+1215.972*n,E=4758.686*a-1052.797-7193.992*o+3651.957*n,f=16178.11*a-3581.69-24462.77*o+12422.52*n,g=a>.715?29936.92*a-5149.66-54087.36*o+31324.56*n:1464.74-4664.75*a+3763.64*o),a<.7?(I=4988.61*a-919.2277-9064.77*o+5542.21*n,p=4568.6173*a-822.71072-8491.4146*o+5337.524*n,D=4690.25*a-853.666-8624.77*o+5341.4*n):(I=161616.52*a-37995.78-229838.2*o+109377.94*n,p=218913.95*a-51752.104-309468.16*o+146349.42*n,D=170470.89*a-40023.88-242699.48*o+115605.82*n);const T=.75*(1+2*s+M),C=1.5*i,N=1.875*c*(1-2*s-3*M),R=-1.875*c*(1+2*s-3*M),y=35*i*T,O=39.375*i*i,b=9.84375*c*(i*(1-2*s-5*M)+.33333333*(4*s-2+6*M)),_=c*(4.92187512*i*(-2-4*s+10*M)+6.56250012*(1+2*s-3*M)),w=29.53125*c*(2-8*s+M*(8*s-12+10*M)),A=29.53125*c*(-2-8*s+M*(12+8*s-10*M)),P=17891679e-13,B=3.7393792e-7,L=7.3636953e-9,S=1.1428639e-7,v=2.1765803e-9,Z=e.meanMotionBrouwer,U=e.semiMajorAxisBrouwer,F=Z*Z*3;return{D2201:F/U**2*P*T*l,D2211:F/U**2*P*C*m,D3210:F/U**3*B*N*d,D3222:F/U**3*B*R*u,D4410:F/U**4*2*L*y*E,D4422:F/U**4*2*L*O*f,D5220:F/U**5*S*b*g,D5232:F/U**5*S*_*D,D5421:F/U**5*2*v*w*p,D5433:F/U**5*2*v*A*I}}(t,e)),{type:o,coeffs:a}}(t,e.brouwer),e.integrationState=function(t,e,a,o,n){const r=h(t.meanAnomaly),c=h(t.raAscNode),i=h(t.argPerigee),s=M(t.jtUt1Epoch),l=.0043752690880113;let m,d,u;return n==_.HALF_DAY_RESONANCE?(m=(r+2*c-2*s)%(2*Math.PI),d=o.MDot+a.dMdt+2*(o.OmegaDot+a.dOmegadt-l)-e.meanMotionBrouwer,u=e.meanMotionBrouwer):n==_.ONE_DAY_RESONANCE&&(m=(r+c+i-s)%(2*Math.PI),d=o.MDot+a.dMdt+o.OmegaDot+a.dOmegadt+o.omegaDot+a.domegadt-l-e.meanMotionBrouwer,u=e.meanMotionBrouwer),{minsAfterEpoch:0,lambda:m,lambda0:m,dlambdadt:d,dlambdadt0:d,n:u,n0:u,dndt:0}}(t,e.brouwer,e.thirdBodyCommon.secularRates,e.secGrav,e.resonance.type),e.dragTerms.useSimplifiedDrag=!0),e}function P(t,e,a){if("number"!=typeof e)throw{type:s.ERROR_INVALID_TSINCE,message:"tSince parameter "+e+" not a number!"};void 0===a&&(a=0);const o=60*(e-t.lastTime),n=t.tle.jtUt1Epoch+e/1440;if(void 0===t.lastTime);else if(Math.abs(o)<a)return{r:[t.lastOsv.r[0]+t.lastOsv.v[0]*o,t.lastOsv.r[1]+t.lastOsv.v[1]*o,t.lastOsv.r[2]+t.lastOsv.v[2]*o],v:t.lastOsv.v};let r;if(t.solverType==w.SGP4){const a=u(t.tle,t.brouwer,t.secGrav,e),o=function(t,e,a,o,n){const{C1:r,C2:c,C3:s,C4:M,C5:m,D2:d,D3:u,D4:E,qs4Term:f,s:g,t2cof:p,t3cof:D,t4cof:I,t5cof:T,xi:C,eta:N,beta0:R,theta:y,useSimplifiedDrag:O}=o,b=(h(t.meanAnomaly),h(t.argPerigee)),_=h(t.meanAnomaly),w=t.eccentricity,A=l(e.semiMajorAxisBrouwer,2),P=e.meanMotionBrouwer,B=l(n,5),L=(h(t.inclination),.5*i.j2),S=t.dragTerm;let v,Z,U,F,j,k;if(O){v=a.M,Z=a.omega,U=a.Omega-P*L*y[1]*10.5/(A[2]*R[2])*r[1]*B[2],F=t.eccentricity-S*M*B[1],F<1e-6&&(F=1e-6);const o=e.meanMotionBrouwer;j=Math.pow(i.xke/o,2/3)*Math.pow(1-r[1]*B[1],2),k=v+Z+U+P*(p*B[2])}else{const o=t.dragTerm*s*Math.cos(b)*n;let c=-2/3*f*t.dragTerm*C[4]/(N[1]*w)*(Math.pow(1+N[1]*Math.cos(a.M),3)-Math.pow(1+N[1]*Math.cos(_),3));t.eccentricity<=1e-4&&(c=0),v=a.M+o+c,Z=a.omega-o-c,U=a.Omega-P*L*y[1]*10.5/(A[2]*R[2])*r[1]*B[2],F=t.eccentricity-S*M*B[1]-S*m*(Math.sin(v)-Math.sin(_)),F<1e-6&&(F=1e-6);const h=e.meanMotionBrouwer;j=Math.pow(i.xke/h,2/3)*Math.pow(1-r[1]*B[1]-d*B[2]-u*B[3]-E*B[4],2),k=v+Z+U+P*(p*B[2]+D*B[3]+I*B[4]+T*B[5])}return k%=2*Math.PI,v=(k-Z-U)%(2*Math.PI),{a:j,incl:a.incl,ecc:F,M:v,omega:Z,Omega:U,L:k}}(t.tle,t.brouwer,a,t.dragTerms,e);if(o.ecc>=1||o.ecc<-.001)throw{type:s.ERROR_PERT_ECCENTRICITY,message:"Eccentricity "+kepler4.ecc+" invalid!"};r=p(E(t.tle,o))}else{const a=function(t,e,a){return{a:t.a,incl:t.incl+a*e.dIdt,ecc:t.ecc+a*e.dedt,M:t.M+a*e.dMdt,omega:t.omega+a*e.domegadt,Omega:t.Omega+a*e.dOmegadt}}(u(t.tle,t.brouwer,t.secGrav,e),t.thirdBodyCommon.secularRates,e);let o;if(o=t.resonance.type==_.NO_RESONANCE?{M:a.M,n:i.xke/Math.pow(a.a,1.5)}:function(t,e,a,o,n,r){let c=720,i=c*c;n-r.minsAfterEpoch<0&&(c=-c);const s=5.7686396,l=.95240898,m=1.8014998,d=1.050833,u=4.4108898,E=.13130908,f=2.8843198,g=.37448087,p=(M(t.jtUt1Epoch)+.0043752690880113*n)%(2*Math.PI);for(;;){if(e.type==_.ONE_DAY_RESONANCE){const t=e.coeffs;r.dndt=t.delta1*Math.sin(r.lambda-E)+t.delta2*Math.sin(2*(r.lambda-f))+t.delta3*Math.sin(3*(r.lambda-g)),r.dlambdadt=r.n+r.dlambdadt0,r.dnddt=t.delta1*Math.cos(r.lambda-E)+2*t.delta2*Math.cos(2*(r.lambda-f))+3*t.delta3*Math.cos(3*(r.lambda-g)),r.dnddt*=r.dlambdadt}else if(e.type==_.HALF_DAY_RESONANCE){const o=h(t.argPerigee)+a.omegaDot*r.minsAfterEpoch,n=e.coeffs;r.dndt=n.D2201*Math.sin(2*o+r.lambda-s)+n.D2211*Math.sin(r.lambda-s)+n.D3210*Math.sin(o+r.lambda-l)+n.D3222*Math.sin(-o+r.lambda-l)+n.D4410*Math.sin(2*o+2*r.lambda-m)+n.D4422*Math.sin(2*r.lambda-m)+n.D5220*Math.sin(o+r.lambda-d)+n.D5232*Math.sin(-o+r.lambda-d)+n.D5421*Math.sin(o+2*r.lambda-u)+n.D5433*Math.sin(-o+2*r.lambda-u),r.dlambdadt=r.n+r.dlambdadt0,r.dnddt=n.D2201*Math.cos(2*o+r.lambda-s)+n.D2211*Math.cos(r.lambda-s)+n.D3210*Math.cos(o+r.lambda-l)+n.D3222*Math.cos(-o+r.lambda-l)+n.D5220*Math.cos(o+r.lambda-d)+n.D5232*Math.cos(-o+r.lambda-d)+2*(n.D4410*Math.cos(2*o+2*r.lambda-m)+n.D4422*Math.cos(2*r.lambda-m)+n.D5421*Math.cos(o+2*r.lambda-u)+n.D5433*Math.cos(-o+2*r.lambda-u)),r.dnddt*=r.dlambdadt}if(Math.abs(r.minsAfterEpoch-n)<Math.abs(c))break;r.lambda+=r.dlambdadt*c+.5*r.dndt*i,r.n+=r.dndt*c+.5*r.dnddt*i,r.minsAfterEpoch+=c}const D=n-r.minsAfterEpoch,I=r.lambda+r.dlambdadt*D+.5*r.dndt*D**2,T=r.n+r.dndt*D+.5*r.dnddt*D**2;let C;return e.type==_.HALF_DAY_RESONANCE?C=(I-2*o.Omega+2*p)%(2*Math.PI):e.type==_.ONE_DAY_RESONANCE&&(C=(I-o.Omega-o.omega+p)%(2*Math.PI)),{M:C,n:T}}(t.tle,t.resonance,t.secGrav,a,e,t.integrationState),o.n<=0)throw{type:s.ERROR_MEAN_MOTION,message:"Mean motion "+o.n+" invalid!"};const n=Math.pow(i.xke/o.n,2/3)*Math.pow(1-t.dragTerms.C1[1]*e,2),c=i.xke/Math.pow(n,1.5),l=a.ecc-t.tle.dragTerm*t.dragTerms.C4*e;if(l>=1||l<-.001)throw{type:s.ERROR_MEAN_ECCENTRICITY,message:"Mean eccentricity "+l+" invalid!"};let m=(o.M+t.brouwer.meanMotionBrouwer*t.dragTerms.t2cof*e*e)%(2*Math.PI);const d={a:n,incl:a.incl,ecc:l,M:m,omega:a.omega,Omega:a.Omega,n:c},f=function(t,e,a,o,n,r){const c=t.jtUt1Epoch-2415020,i=4.7199672+.2299715*c-(5.8351514+.001944368*c),s=(6.2565837+.017201977*c+119459e-10*r)%(2*Math.PI),M=(i+.00015835218*r)%(2*Math.PI),h=t.eccentricity,l=e.meanMotionBrouwer,m=b(h,l,a,s,.01675,298647972e-14),d=b(h,l,o,M,.0549,4.796806521e-7),u=m.deltaecc+d.deltaecc,E=m.deltaI+d.deltaI,f=m.deltaM+d.deltaM,g=m.deltaomegaI+d.deltaomegaI,p=m.deltaOmegaI+d.deltaOmegaI,D=n.ecc+u,I=n.incl+E;let T,C,N;if(I>=.2){const t=p/Math.sin(I),e=g-Math.cos(I)*t;T=n.omega+e,C=n.Omega+t,N=n.M+f}else{const t=Math.sin(I)*Math.sin(n.Omega)+p*Math.cos(n.Omega)+E*Math.cos(I)*Math.sin(n.Omega),e=Math.sin(I)*Math.cos(n.Omega)-p*Math.sin(n.Omega)+E*Math.cos(I)*Math.cos(n.Omega);C=n.Omega%(2*Math.PI),C<0&&(C+=2*Math.PI);const a=(n.M+n.omega+Math.cos(I)*C+f+g-E*Math.sin(I)*C)%(2*Math.PI),o=C;C=Math.atan2(t,e),C<0&&(C+=2*Math.PI),Math.abs(C-o)>Math.PI&&(C<o?C+=2*Math.PI:C-=2*Math.PI),N=n.M+f,T=a-N-Math.cos(I)*C}return{a:n.a,n:n.n,ecc:D,incl:I,Omega:C,omega:T,M:N}}(t.tle,t.brouwer,t.thirdBodyCommon.sun,t.thirdBodyCommon.moon,d,e);if(f.incl<0&&(f.incl*=-1,f.Omega+=Math.PI,f.omega-=Math.PI),f.ecc<0||f.ecc>1)throw{type:s.ERROR_PERT_ECCENTRICITY,message:"Eccentricity "+f.ecc+" invalid!"};r=p(E(t.tle,f,f.incl))}return t.lastTime=e,t.lastOsv=r,r.JT=n,r}function B(t,e,a){return P(t,1440*(e-t.tle.jtUt1Epoch),a)}function L(t,e,a){return B(t,c(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()+.001*e.getUTCMilliseconds()),a)}return e})()));